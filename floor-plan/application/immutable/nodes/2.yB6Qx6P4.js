var Ye=Object.defineProperty;var We=(S,f,w)=>f in S?Ye(S,f,{enumerable:!0,configurable:!0,writable:!0,value:w}):S[f]=w;var N=(S,f,w)=>(We(S,typeof f!="symbol"?f+"":f,w),w);import{h as Ue,s as Yt,f as Wt,r as ze,b as K,o as He,y as Kt,z as $,e as Qt,n as Je}from"../chunks/scheduler.3azYSKjP.js";import{S as Ut,i as Ht,e as W,s as ot,m as Zt,c as U,d as Q,g as E,h as st,o as L,j as Z,y as H,t as m,q as Te,a as at,n as Ne,p as it,k as J,z as Fe,A as Ee,B as Gt,C as Ve,u as $t,v as mt,w as te,x as ee}from"../chunks/index.-TIuWNLo.js";import{w as ft}from"../chunks/index.km8bIHBx.js";function re(S){return(S==null?void 0:S.length)!==void 0?S:Array.from(S)}function gt(S,{delay:f=0,duration:w=400,easing:d=Ue}={}){const _=+getComputedStyle(S).opacity;return{delay:f,duration:w,easing:d,css:c=>`opacity: ${c*_}`}}const ut=ft([]),nt=ft([]),yt=ft("None"),lt=ft(),ct=ft(),vt=ft([]);var tt=(S=>(S.Drawing="Drawing",S.None="None",S))(tt||{}),rt=(S=>(S[S.Left=0]="Left",S[S.Right=1]="Right",S[S.Center=2]="Center",S[S.Top=3]="Top",S[S.Bottom=4]="Bottom",S))(rt||{}),B=(S=>(S.Door="Door",S.DoubleDoor="DoubleDoor",S.Desk="Desk",S.ParkingSpace="ParkingSpace",S.Stairs="Stairs",S.Window="Window",S.Room="Room",S))(B||{});function Ke(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}function Le(S){throw new Error('Could not dynamically require "'+S+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ce={exports:{}},dt={exports:{}},ne;function Qe(){return ne||(ne=1,function(S){(function f(w,d,_){var c=function(n){return Object.prototype.toString.call(n)==="[object Array]"};function v(n,r){if(!(this instanceof v))return new v(n,r);c(n)?(r=n[1],n=n[0]):typeof n=="object"&&n&&(r=n.y,n=n.x),this.x=v.clean(n||0),this.y=v.clean(r||0)}v.prototype={change:function(n){if(typeof n=="function")this.observers?this.observers.push(n):this.observers=[n];else if(this.observers&&this.observers.length)for(var r=this.observers.length-1;r>=0;r--)this.observers[r](this,n);return this},ignore:function(n){if(this.observers)if(!n)this.observers=[];else for(var r=this.observers,h=r.length;h--;)r[h]===n&&r.splice(h,1);return this},set:function(n,r,h){if(typeof n!="number"&&(h=r,r=n.y,n=n.x),this.x===n&&this.y===r)return this;var b=null;if(h!==!1&&this.observers&&this.observers.length&&(b=this.clone()),this.x=v.clean(n),this.y=v.clean(r),h!==!1)return this.change(b)},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(n){return n?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(n,r,h){return typeof n!="number"&&(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),n+=this.x,r+=this.y,h?new this.constructor(n,r):this.set(n,r)},subtract:function(n,r,h){return typeof n!="number"&&(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),n=this.x-n,r=this.y-r,h?new this.constructor(n,r):this.set(n,r)},multiply:function(n,r,h){return typeof n!="number"?(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)):typeof r!="number"&&(h=r,r=n),n*=this.x,r*=this.y,h?new this.constructor(n,r):this.set(n,r)},rotate:function(n,r,h){var b=this.x,k=this.y,a=Math.cos(n),l=Math.sin(n),g,p;return r=r?-1:1,g=a*b-r*l*k,p=r*l*b+a*k,h?new this.constructor(g,p):this.set(g,p)},length:function(){var n=this.x,r=this.y;return Math.sqrt(n*n+r*r)},lengthSquared:function(){var n=this.x,r=this.y;return n*n+r*r},distance:function(n){var r=this.x-n.x,h=this.y-n.y;return Math.sqrt(r*r+h*h)},nearest:function(n){for(var r=Number.MAX_VALUE,h=null,b,k=n.length-1;k>=0;k--)b=this.distance(n[k]),b<=r&&(r=b,h=n[k]);return h},normalize:function(n){var r=this.length(),h=r<Number.MIN_VALUE?0:1/r;return n?new this.constructor(this.x*h,this.y*h):this.set(this.x*h,this.y*h)},equal:function(n,r){return typeof n!="number"&&(c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),v.clean(n)===this.x&&v.clean(r)===this.y},abs:function(n){var r=Math.abs(this.x),h=Math.abs(this.y);return n?new this.constructor(r,h):this.set(r,h)},min:function(n,r){var h=this.x,b=this.y,k=n.x,a=n.y,l=h<k?h:k,g=b<a?b:a;return r?new this.constructor(l,g):this.set(l,g)},max:function(n,r){var h=this.x,b=this.y,k=n.x,a=n.y,l=h>k?h:k,g=b>a?b:a;return r?new this.constructor(l,g):this.set(l,g)},clamp:function(n,r,h){var b=this.min(r,!0).max(n);return h?b:this.set(b.x,b.y)},lerp:function(n,r,h){return this.add(n.subtract(this,!0).multiply(r),h)},skew:function(n){return n?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(n){return v.clean(this.x*n.x+n.y*this.y)},perpDot:function(n){return v.clean(this.x*n.y-this.y*n.x)},angleTo:function(n){return Math.atan2(this.perpDot(n),this.dot(n))},divide:function(n,r,h){if(typeof n!="number"?(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)):typeof r!="number"&&(h=r,r=n),n===0||r===0)throw new Error("division by zero");if(isNaN(n)||isNaN(r))throw new Error("NaN detected");return h?new this.constructor(this.x/n,this.y/r):this.set(this.x/n,this.y/r)},isPointOnLine:function(n,r){return(n.y-this.y)*(n.x-r.x)===(n.y-r.y)*(n.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(n){return this.set(n[0],n[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:v},v.fromArray=function(n,r){return new(r||v)(n[0],n[1])},v.precision=d||8;var o=Math.pow(10,v.precision);return v.clean=w||function(n){if(isNaN(n))throw new Error("NaN detected");if(!isFinite(n))throw new Error("Infinity detected");return Math.round(n)===n?n:Math.round(n*o)/o},v.inject=f,w||(v.fast=f(function(n){return n}),S.exports=v),v})()}(dt)),dt.exports}var xt={exports:{}},ie;function Jt(){return ie||(ie=1,function(S){function f(w,d,_,c,v,o,n,r){if(arguments.length===4){var h=w,b=d,k=_,a=c;h.length&&h.length===2?(w=h[0],d=h[1],_=b[0],c=b[1],v=k[0],o=k[1],n=a[0],r=a[1]):(w=h.x,d=h.y,_=b.x,c=b.y,v=k.x,o=k.y,n=a.x,r=a.y)}var l,g,p,i,s,t,e,u,M,O,x,D,q;if(l=c-d,p=w-_,s=_*d-w*c,M=l*v+p*o+s,O=l*n+p*r+s,!(M!==0&&O!==0&&(M>=0&&O>=0||M<0&&O<0))&&(g=r-o,i=v-n,t=n*o-v*r,e=g*w+i*d+t,u=g*_+i*c+t,!(e!==0&&u!==0&&(e>=0&&u>=0||e<0&&u<0))))return x=l*i-g*p,x===0?!0:(D=p*t-i*s,q=g*s-l*t,[(D<0,D/x),(q<0,q/x)])}S.exports&&(S.exports=f),typeof window<"u"&&(window.segseg=window.segseg||f)}(xt)),xt.exports}var _t={exports:{}},bt={exports:{}},oe;function Ze(){return oe||(oe=1,function(S){(function f(w,d,_){function c(o,n){if(!(this instanceof c))return new c(o,n);if(typeof o=="object"&&o){this.y=o.y||0,this.x=o.x||0;return}this.x=c.clean(o||0),this.y=c.clean(n||0)}c.prototype={change:function(o){if(o)this.observers?this.observers.push(o):this.observers=[o];else if(this.observers)for(var n=this.observers.length-1;n>=0;n--)this.observers[n](this);return this},ignore:function(o){if(this.observers)for(var n=this.observers,r=n.length;r--;)n[r]===o&&n.splice(r,1);return this},set:function(o,n,r){if(typeof o!="number"&&(r=n,n=o.y,o=o.x),this.x===o&&this.y===n)return this;if(this.x=c.clean(o),this.y=c.clean(n),r!==!1)return this.change()},zero:function(){return this.set(0,0)},clone:function(){return new c(this.x,this.y)},negate:function(o){return o?new c(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(o,n){return n?new c(this.x+o.x,this.y+o.y):(this.x+=o.x,this.y+=o.y,this.change())},subtract:function(o,n){return n?new c(this.x-o.x,this.y-o.y):(this.x-=o.x,this.y-=o.y,this.change())},multiply:function(o,n){var r,h;return typeof o!="number"?(r=o.x,h=o.y):r=h=o,n?new c(this.x*r,this.y*h):this.set(this.x*r,this.y*h)},rotate:function(o,n,r){var h=this.x,b=this.y,k=Math.cos(o),a=Math.sin(o),l,g;return n=n?-1:1,l=k*h-n*a*b,g=n*a*h+k*b,r?new c(l,g):this.set(l,g)},length:function(){var o=this.x,n=this.y;return Math.sqrt(o*o+n*n)},lengthSquared:function(){var o=this.x,n=this.y;return o*o+n*n},distance:function(o){var n=this.x-o.x,r=this.y-o.y;return Math.sqrt(n*n+r*r)},normalize:function(o){var n=this.length(),r=n<Number.MIN_VALUE?0:1/n;return o?new c(this.x*r,this.y*r):this.set(this.x*r,this.y*r)},equal:function(o,n){return n===_&&(n=o.y,o=o.x),c.clean(o)===this.x&&c.clean(n)===this.y},abs:function(o){var n=Math.abs(this.x),r=Math.abs(this.y);return o?new c(n,r):this.set(n,r)},min:function(o,n){var r=this.x,h=this.y,b=o.x,k=o.y,a=r<b?r:b,l=h<k?h:k;return n?new c(a,l):this.set(a,l)},max:function(o,n){var r=this.x,h=this.y,b=o.x,k=o.y,a=r>b?r:b,l=h>k?h:k;return n?new c(a,l):this.set(a,l)},clamp:function(o,n,r){var h=this.min(n,!0).max(o);return r?h:this.set(h.x,h.y)},lerp:function(o,n){return this.add(o.subtract(this,!0).multiply(n),!0)},skew:function(){return new c(-this.y,this.x)},dot:function(o){return c.clean(this.x*o.x+o.y*this.y)},perpDot:function(o){return c.clean(this.x*o.y-this.y*o.x)},angleTo:function(o){return Math.atan2(this.perpDot(o),this.dot(o))},divide:function(o,n){var r,h;if(typeof o!="number"?(r=o.x,h=o.y):r=h=o,r===0||h===0)throw new Error("division by zero");if(isNaN(r)||isNaN(h))throw new Error("NaN detected");return n?new c(this.x/r,this.y/h):this.set(this.x/r,this.y/h)},isPointOnLine:function(o,n){return(o.y-this.y)*(o.x-n.x)===(o.y-n.y)*(o.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(o){return this.set(o[0],o[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"}},c.fromArray=function(o){return new c(o[0],o[1])},c.precision=d||8;var v=Math.pow(10,c.precision);return c.clean=w||function(o){if(isNaN(o))throw new Error("NaN detected");if(!isFinite(o))throw new Error("Infinity detected");return Math.round(o)===o?o:Math.round(o*v)/v},c.inject=f,w||(c.fast=f(function(o){return o}),S.exports=c),c})()}(bt)),bt.exports}var se;function Ge(){return se||(se=1,function(S){if(typeof Le<"u")var f=Ze(),w=Jt();var d=function(r){return Object.prototype.toString.call(r)==="[object Array]"},_=function(r){return typeof r<"u"},c=function(r,h){return _(r)?r:h},v=function(r){return r!==1/0&&r!==-1/0},o=function(r,h,b,k){return r*k-h*b};function n(r,h,b,k){if(this._listeners=[],!(this instanceof n))return new n(r,h,b,k);if(_(b)&&_(k))return n.fromPoints(r,h,b,k);_(r)&&this.slope(r),_(h)&&this.yintercept(h)}n.prototype._yintercept=null,n.prototype._xintercept=null,n.prototype._slope=null,n.prototype.change=function(r){if(typeof r=="function")return this._listeners.push(r),r},n.prototype.ignore=function(r){r?this._listeners=this._listeners.filter(function(h){return h!==r}):this._listeners=[]},n.prototype.notify=function(r){for(var h=this._listeners,b=h.length,k=0;k<b;k++)h[k](this)},n.prototype.yintercept=function(r){return _(r)&&(v(r)&&(r=f.clean(r)),this._yintercept!==r&&(this._yintercept=r,this.isHorizontal()||(this._xintercept=this.solveForX(0)),this.notify())),c(this._yintercept,null)},n.prototype.xintercept=function(r){if(_(r)&&(v(r)&&(r=f.clean(r)),this._xintercept!==r)){if(!this.isVertical()){var h=this._xintercept-r;this._yintercept-=h*-this._slope}this._xintercept=r,this.notify()}return c(this._xintercept,null)},n.prototype.slope=function(r){if(_(r)&&(v(r)&&(r=f.clean(r)),this._slope!==r)){var h=this._slope;if(this._slope=r,h!==null){var b=this.solveForX(0);v(b)||(b=null),this._xintercept=b}this.notify()}return c(this._slope,null)},n.prototype.intersectSegment=function(r,h,b,k){var a=b-r,l=k-h,g,p,i,s,t=this.isHorizontal(),e=this.isVertical();if(a===0){if(e)return r===this.xintercept()}else if(l===0){if(t)return h===this.yintercept()}else if(l/a===this.slope())return h===this.solveForY(r);r>b?(g=b-10,i=r+10):(g=r-10,i=b+10);var u;if(this.isHorizontal())y=this.yintercept(),u=w(g,y,i,y,r,h,b,k);else if(this.isVertical()){h>k?(p=k-10,s=h+10):(p=h-10,s=k+10);var M=this.xintercept();u=w(M,p,M,s,r,h,b,k)}else p=this.solveForY(g),s=this.solveForY(i),u=w(g,p,i,s,r,h,b,k);return u&&u!==!0?f.fromArray(u):u},n.prototype.createPerpendicular=function(r){if(this.isVertical())return new n(0,r.y);if(this.isHorizontal()){var h=new n;return h.xintercept(r.x),h.slope(1/0),h}else{var b=-1/this.slope();return new n(b,r.y-b*r.x)}},n.prototype.intersectCircle=function(r,h){var b=h*h,k=this.slope(),a=this.yintercept(),l,g,p,i;this.isHorizontal()?(l=1,g=0):this.isVertical()?(k=h,a=b,l=0,g=k):(l=1/k,g=1);var s=this.isVertical()?this.xintercept():1,t=a+k,e=l*l,u=g*g,M=l*(r.y-t)-g*(r.x-s);M*=M;var O=e+u,x=Math.sqrt(b*(e+u)-M);if(isNaN(x))return[];x/=O;var D=l*(r.x-s)+g*(r.y-t),q=D/O+x,P=D/O-x;p=new f(s+q*l,t+q*g),i=new f(s+P*l,t+P*g);var R=[p];return p.equal(i)||R.push(i),R},n.prototype.solveForX=function(r){return this.isVertical()?this.xintercept():(r-this.yintercept())/this.slope()},n.prototype.solveForY=function(r){return this.isHorizontal()?this.yintercept():this.slope()*r+this.yintercept()},n.prototype.intersect=function(r,h,b,k){if(_(h)&&_(k)||_(r.end))return this.intersectSegment(r,h,b,k);var a=this.slope(),l=r.slope();if(a===l)return this.yintercept()===r.yintercept()&&this.xintercept()===r.xintercept();if(v(a)&&v(l)){if(this.isHorizontal())return new f(r.solveForX(this.yintercept()),this.yintercept());if(r.isHorizontal())return new f(this.solveForX(r.yintercept()),r.yintercept());var g=r.solveForX(-1);h=r.solveForY(g),b=r.solveForX(1),k=r.solveForY(b);var p=this.solveForX(-1),i=this.solveForY(p),s=this.solveForX(1),t=this.solveForY(s),e=o(g,h,b,k),u=o(p,i,s,t),M=o(e,g-b,u,p-s),O=o(e,h-k,u,i-t),x=o(g-b,h-k,p-s,i-t);return f(M/x,O/x)}else{var D,q,P=this.xintercept()||r.xintercept();return v(a)?(D=a,q=this.yintercept()):(D=l,q=r.yintercept()),D!==0?f(P,P*D+q):f(P,q)}},n.fromPoints=function(r,h,b,k){d(h)?(k=h[1],b=h[0]):_(h)&&_(h.x)&&_(h.y)&&(k=h.y,b=h.x),d(r)?(h=r[1],r=r[0]):_(r)&&_(r.x)&&_(r.y)&&(h=r.y,r=r.x);var a=new n,l=(k-h)/(b-r);return a.slope(l),a.isHorizontal()?a.yintercept(h):a.isVertical()?a.xintercept(b):a.yintercept(h-l*r),a},n.prototype.isHorizontal=function(){return!this.slope()},n.prototype.isVertical=function(){return!v(this.slope())},n.prototype.closestPointTo=function(r){var h=this.yintercept(),b=this.xintercept();return this.slope(),this.isHorizontal()?f(r.x,h):this.isVertical()?f(b,r.y):this.intersect(this.createPerpendicular(r))},n.prototype.containsPoint=function(r,h){var b=r;return _(h)||(h=r.y,b=r.x),this.isHorizontal()?h===this.yintercept():this.isVertical()?b===this.xintercept():h===this.solveForY(b)},S.exports=n,typeof window<"u"&&(window.Line2=window.Line2||n)}(_t)),_t.exports}var kt={exports:{}},St,ae;function Vt(){if(ae)return St;ae=1,St=f;var S=+(Math.pow(2,27)+1);function f(w,d,_){var c=w*d,v=S*w,o=v-w,n=v-o,r=w-n,h=S*d,b=h-d,k=h-b,a=d-k,l=c-n*k,g=l-r*k,p=g-n*a,i=r*a-p;return _?(_[0]=i,_[1]=c,_):[i,c]}return St}var Dt,fe;function je(){if(fe)return Dt;fe=1,Dt=f;function S(w,d){var _=w+d,c=_-w,v=_-c,o=d-c,n=w-v,r=n+o;return r?[r,_]:[_]}function f(w,d){var _=w.length|0,c=d.length|0;if(_===1&&c===1)return S(w[0],d[0]);var v=_+c,o=new Array(v),n=0,r=0,h=0,b=Math.abs,k=w[r],a=b(k),l=d[h],g=b(l),p,i;a<g?(i=k,r+=1,r<_&&(k=w[r],a=b(k))):(i=l,h+=1,h<c&&(l=d[h],g=b(l))),r<_&&a<g||h>=c?(p=k,r+=1,r<_&&(k=w[r],a=b(k))):(p=l,h+=1,h<c&&(l=d[h],g=b(l)));for(var s=p+i,t=s-p,e=i-t,u=e,M=s,O,x,D,q,P;r<_&&h<c;)a<g?(p=k,r+=1,r<_&&(k=w[r],a=b(k))):(p=l,h+=1,h<c&&(l=d[h],g=b(l))),i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O;for(;r<_;)p=k,i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O,r+=1,r<_&&(k=w[r]);for(;h<c;)p=l,i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O,h+=1,h<c&&(l=d[h]);return u&&(o[n++]=u),M&&(o[n++]=M),n||(o[n++]=0),o.length=n,o}return Dt}var qt,ue;function $e(){if(ue)return qt;ue=1,qt=S;function S(f,w,d){var _=f+w,c=_-f,v=_-c,o=w-c,n=f-v;return d?(d[0]=n+o,d[1]=_,d):[n+o,_]}return qt}var Mt,he;function Be(){if(he)return Mt;he=1;var S=Vt(),f=$e();Mt=w;function w(d,_){var c=d.length;if(c===1){var v=S(d[0],_);return v[0]?v:[v[1]]}var o=new Array(2*c),n=[.1,.1],r=[.1,.1],h=0;S(d[0],_,n),n[0]&&(o[h++]=n[0]);for(var b=1;b<c;++b){S(d[b],_,r);var k=n[1];f(k,r[0],n),n[0]&&(o[h++]=n[0]);var a=r[1],l=n[1],g=a+l,p=g-a,i=l-p;n[1]=g,i&&(o[h++]=i)}return n[1]&&(o[h++]=n[1]),h===0&&(o[h++]=0),o.length=h,o}return Mt}var Pt,le;function me(){if(le)return Pt;le=1,Pt=f;function S(w,d){var _=w+d,c=_-w,v=_-c,o=d-c,n=w-v,r=n+o;return r?[r,_]:[_]}function f(w,d){var _=w.length|0,c=d.length|0;if(_===1&&c===1)return S(w[0],-d[0]);var v=_+c,o=new Array(v),n=0,r=0,h=0,b=Math.abs,k=w[r],a=b(k),l=-d[h],g=b(l),p,i;a<g?(i=k,r+=1,r<_&&(k=w[r],a=b(k))):(i=l,h+=1,h<c&&(l=-d[h],g=b(l))),r<_&&a<g||h>=c?(p=k,r+=1,r<_&&(k=w[r],a=b(k))):(p=l,h+=1,h<c&&(l=-d[h],g=b(l)));for(var s=p+i,t=s-p,e=i-t,u=e,M=s,O,x,D,q,P;r<_&&h<c;)a<g?(p=k,r+=1,r<_&&(k=w[r],a=b(k))):(p=l,h+=1,h<c&&(l=-d[h],g=b(l))),i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O;for(;r<_;)p=k,i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O,r+=1,r<_&&(k=w[r]);for(;h<c;)p=l,i=u,s=p+i,t=s-p,e=i-t,e&&(o[n++]=e),O=M+s,x=O-M,D=O-x,q=s-x,P=M-D,u=P+q,M=O,h+=1,h<c&&(l=-d[h]);return u&&(o[n++]=u),M&&(o[n++]=M),n||(o[n++]=0),o.length=n,o}return Pt}var ce;function wt(){return ce||(ce=1,function(S){var f=Vt(),w=je(),d=Be(),_=me(),c=5,v=11102230246251565e-32,o=(3+16*v)*v,n=(7+56*v)*v;function r(t,e,u,M){return function(x,D,q){var P=t(t(e(D[1],q[0]),e(-q[1],D[0])),t(e(x[1],D[0]),e(-D[1],x[0]))),R=t(e(x[1],q[0]),e(-q[1],x[0])),A=M(P,R);return A[A.length-1]}}function h(t,e,u,M){return function(x,D,q,P){var R=t(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),D[2]),t(u(t(e(D[1],P[0]),e(-P[1],D[0])),-q[2]),u(t(e(D[1],q[0]),e(-q[1],D[0])),P[2]))),t(u(t(e(D[1],P[0]),e(-P[1],D[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),P[2])))),A=t(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-q[2]),u(t(e(x[1],q[0]),e(-q[1],x[0])),P[2]))),t(u(t(e(D[1],q[0]),e(-q[1],D[0])),x[2]),t(u(t(e(x[1],q[0]),e(-q[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),q[2])))),T=M(R,A);return T[T.length-1]}}function b(t,e,u,M){return function(x,D,q,P,R){var A=t(t(t(u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),q[2]),t(u(t(e(q[1],R[0]),e(-R[1],q[0])),-P[2]),u(t(e(q[1],P[0]),e(-P[1],q[0])),R[2]))),D[3]),t(u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),D[2]),t(u(t(e(D[1],R[0]),e(-R[1],D[0])),-P[2]),u(t(e(D[1],P[0]),e(-P[1],D[0])),R[2]))),-q[3]),u(t(u(t(e(q[1],R[0]),e(-R[1],q[0])),D[2]),t(u(t(e(D[1],R[0]),e(-R[1],D[0])),-q[2]),u(t(e(D[1],q[0]),e(-q[1],D[0])),R[2]))),P[3]))),t(u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),D[2]),t(u(t(e(D[1],P[0]),e(-P[1],D[0])),-q[2]),u(t(e(D[1],q[0]),e(-q[1],D[0])),P[2]))),-R[3]),t(u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),D[2]),t(u(t(e(D[1],R[0]),e(-R[1],D[0])),-P[2]),u(t(e(D[1],P[0]),e(-P[1],D[0])),R[2]))),x[3]),u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-P[2]),u(t(e(x[1],P[0]),e(-P[1],x[0])),R[2]))),-D[3])))),t(t(u(t(u(t(e(D[1],R[0]),e(-R[1],D[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),R[2]))),P[3]),t(u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),P[2]))),-R[3]),u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),D[2]),t(u(t(e(D[1],P[0]),e(-P[1],D[0])),-q[2]),u(t(e(D[1],q[0]),e(-q[1],D[0])),P[2]))),x[3]))),t(u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-q[2]),u(t(e(x[1],q[0]),e(-q[1],x[0])),P[2]))),-D[3]),t(u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),P[2]))),q[3]),u(t(u(t(e(D[1],q[0]),e(-q[1],D[0])),x[2]),t(u(t(e(x[1],q[0]),e(-q[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),q[2]))),-P[3]))))),T=t(t(t(u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),q[2]),t(u(t(e(q[1],R[0]),e(-R[1],q[0])),-P[2]),u(t(e(q[1],P[0]),e(-P[1],q[0])),R[2]))),x[3]),u(t(u(t(e(P[1],R[0]),e(-R[1],P[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-P[2]),u(t(e(x[1],P[0]),e(-P[1],x[0])),R[2]))),-q[3])),t(u(t(u(t(e(q[1],R[0]),e(-R[1],q[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-q[2]),u(t(e(x[1],q[0]),e(-q[1],x[0])),R[2]))),P[3]),u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),x[2]),t(u(t(e(x[1],P[0]),e(-P[1],x[0])),-q[2]),u(t(e(x[1],q[0]),e(-q[1],x[0])),P[2]))),-R[3]))),t(t(u(t(u(t(e(q[1],R[0]),e(-R[1],q[0])),D[2]),t(u(t(e(D[1],R[0]),e(-R[1],D[0])),-q[2]),u(t(e(D[1],q[0]),e(-q[1],D[0])),R[2]))),x[3]),u(t(u(t(e(q[1],R[0]),e(-R[1],q[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-q[2]),u(t(e(x[1],q[0]),e(-q[1],x[0])),R[2]))),-D[3])),t(u(t(u(t(e(D[1],R[0]),e(-R[1],D[0])),x[2]),t(u(t(e(x[1],R[0]),e(-R[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),R[2]))),q[3]),u(t(u(t(e(D[1],q[0]),e(-q[1],D[0])),x[2]),t(u(t(e(x[1],q[0]),e(-q[1],x[0])),-D[2]),u(t(e(x[1],D[0]),e(-D[1],x[0])),q[2]))),-R[3])))),C=M(A,T);return C[C.length-1]}}function k(t){var e=t===3?r:t===4?h:b;return e(w,f,d,_)}var a=k(3),l=k(4),g=[function(){return 0},function(){return 0},function(e,u){return u[0]-e[0]},function(e,u,M){var O=(e[1]-M[1])*(u[0]-M[0]),x=(e[0]-M[0])*(u[1]-M[1]),D=O-x,q;if(O>0){if(x<=0)return D;q=O+x}else if(O<0){if(x>=0)return D;q=-(O+x)}else return D;var P=o*q;return D>=P||D<=-P?D:a(e,u,M)},function(e,u,M,O){var x=e[0]-O[0],D=u[0]-O[0],q=M[0]-O[0],P=e[1]-O[1],R=u[1]-O[1],A=M[1]-O[1],T=e[2]-O[2],C=u[2]-O[2],et=M[2]-O[2],V=D*A,ht=q*R,I=q*P,z=x*A,F=x*R,X=D*P,Y=T*(V-ht)+C*(I-z)+et*(F-X),j=(Math.abs(V)+Math.abs(ht))*Math.abs(T)+(Math.abs(I)+Math.abs(z))*Math.abs(C)+(Math.abs(F)+Math.abs(X))*Math.abs(et),G=n*j;return Y>G||-Y>G?Y:l(e,u,M,O)}];function p(t){var e=g[t.length];return e||(e=g[t.length]=k(t.length)),e.apply(void 0,t)}function i(t,e,u,M,O,x,D){return function(P,R,A,T,C){switch(arguments.length){case 0:case 1:return 0;case 2:return M(P,R);case 3:return O(P,R,A);case 4:return x(P,R,A,T);case 5:return D(P,R,A,T,C)}for(var et=new Array(arguments.length),V=0;V<arguments.length;++V)et[V]=arguments[V];return t(et)}}function s(){for(;g.length<=c;)g.push(k(g.length));S.exports=i.apply(void 0,[p].concat(g));for(var t=0;t<=c;++t)S.exports[t]=g[t]}s()}(kt)),kt.exports}var Ot,ve;function tr(){if(ve)return Ot;ve=1;function S(v,o,n,r,h){for(var b=h+1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l>=0?(b=k,h=k-1):r=k+1}return b}function f(v,o,n,r,h){for(var b=h+1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l>0?(b=k,h=k-1):r=k+1}return b}function w(v,o,n,r,h){for(var b=r-1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l<0?(b=k,r=k+1):h=k-1}return b}function d(v,o,n,r,h){for(var b=r-1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l<=0?(b=k,r=k+1):h=k-1}return b}function _(v,o,n,r,h){for(;r<=h;){var b=r+h>>>1,k=v[b],a=n!==void 0?n(k,o):k-o;if(a===0)return b;a<=0?r=b+1:h=b-1}return-1}function c(v,o,n,r,h,b){return typeof n=="function"?b(v,o,n,r===void 0?0:r|0,h===void 0?v.length-1:h|0):b(v,o,void 0,n===void 0?0:n|0,r===void 0?v.length-1:r|0)}return Ot={ge:function(v,o,n,r,h){return c(v,o,n,r,h,S)},gt:function(v,o,n,r,h){return c(v,o,n,r,h,f)},lt:function(v,o,n,r,h){return c(v,o,n,r,h,w)},le:function(v,o,n,r,h){return c(v,o,n,r,h,d)},eq:function(v,o,n,r,h){return c(v,o,n,r,h,_)}},Ot}var Rt,ge;function er(){if(ge)return Rt;ge=1,Rt=p;var S=0,f=1;function w(i,s,t,e,u,M){this._color=i,this.key=s,this.value=t,this.left=e,this.right=u,this._count=M}function d(i){return new w(i._color,i.key,i.value,i.left,i.right,i._count)}function _(i,s){return new w(i,s.key,s.value,s.left,s.right,s._count)}function c(i){i._count=1+(i.left?i.left._count:0)+(i.right?i.right._count:0)}function v(i,s){this._compare=i,this.root=s}var o=v.prototype;Object.defineProperty(o,"keys",{get:function(){var i=[];return this.forEach(function(s,t){i.push(s)}),i}}),Object.defineProperty(o,"values",{get:function(){var i=[];return this.forEach(function(s,t){i.push(t)}),i}}),Object.defineProperty(o,"length",{get:function(){return this.root?this.root._count:0}}),o.insert=function(i,s){for(var t=this._compare,e=this.root,u=[],M=[];e;){var O=t(i,e.key);u.push(e),M.push(O),O<=0?e=e.left:e=e.right}u.push(new w(S,i,s,null,null,1));for(var x=u.length-2;x>=0;--x){var e=u[x];M[x]<=0?u[x]=new w(e._color,e.key,e.value,u[x+1],e.right,e._count+1):u[x]=new w(e._color,e.key,e.value,e.left,u[x+1],e._count+1)}for(var x=u.length-1;x>1;--x){var D=u[x-1],e=u[x];if(D._color===f||e._color===f)break;var q=u[x-2];if(q.left===D)if(D.left===e){var P=q.right;if(P&&P._color===S)D._color=f,q.right=_(f,P),q._color=S,x-=1;else{if(q._color=S,q.left=D.right,D._color=f,D.right=q,u[x-2]=D,u[x-1]=e,c(q),c(D),x>=3){var R=u[x-3];R.left===q?R.left=D:R.right=D}break}}else{var P=q.right;if(P&&P._color===S)D._color=f,q.right=_(f,P),q._color=S,x-=1;else{if(D.right=e.left,q._color=S,q.left=e.right,e._color=f,e.left=D,e.right=q,u[x-2]=e,u[x-1]=D,c(q),c(D),c(e),x>=3){var R=u[x-3];R.left===q?R.left=e:R.right=e}break}}else if(D.right===e){var P=q.left;if(P&&P._color===S)D._color=f,q.left=_(f,P),q._color=S,x-=1;else{if(q._color=S,q.right=D.left,D._color=f,D.left=q,u[x-2]=D,u[x-1]=e,c(q),c(D),x>=3){var R=u[x-3];R.right===q?R.right=D:R.left=D}break}}else{var P=q.left;if(P&&P._color===S)D._color=f,q.left=_(f,P),q._color=S,x-=1;else{if(D.left=e.right,q._color=S,q.right=e.left,e._color=f,e.right=D,e.left=q,u[x-2]=e,u[x-1]=D,c(q),c(D),c(e),x>=3){var R=u[x-3];R.right===q?R.right=e:R.left=e}break}}}return u[0]._color=f,new v(t,u[0])};function n(i,s){if(s.left){var t=n(i,s.left);if(t)return t}var t=i(s.key,s.value);if(t)return t;if(s.right)return n(i,s.right)}function r(i,s,t,e){var u=s(i,e.key);if(u<=0){if(e.left){var M=r(i,s,t,e.left);if(M)return M}var M=t(e.key,e.value);if(M)return M}if(e.right)return r(i,s,t,e.right)}function h(i,s,t,e,u){var M=t(i,u.key),O=t(s,u.key),x;if(M<=0&&(u.left&&(x=h(i,s,t,e,u.left),x)||O>0&&(x=e(u.key,u.value),x)))return x;if(O>0&&u.right)return h(i,s,t,e,u.right)}o.forEach=function(s,t,e){if(this.root)switch(arguments.length){case 1:return n(s,this.root);case 2:return r(t,this._compare,s,this.root);case 3:return this._compare(t,e)>=0?void 0:h(t,e,this._compare,s,this.root)}},Object.defineProperty(o,"begin",{get:function(){for(var i=[],s=this.root;s;)i.push(s),s=s.left;return new b(this,i)}}),Object.defineProperty(o,"end",{get:function(){for(var i=[],s=this.root;s;)i.push(s),s=s.right;return new b(this,i)}}),o.at=function(i){if(i<0)return new b(this,[]);for(var s=this.root,t=[];;){if(t.push(s),s.left){if(i<s.left._count){s=s.left;continue}i-=s.left._count}if(!i)return new b(this,t);if(i-=1,s.right){if(i>=s.right._count)break;s=s.right}else break}return new b(this,[])},o.ge=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M<=0&&(u=e.length),M<=0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.gt=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M<0&&(u=e.length),M<0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.lt=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M>0&&(u=e.length),M<=0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.le=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M>=0&&(u=e.length),M<0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.find=function(i){for(var s=this._compare,t=this.root,e=[];t;){var u=s(i,t.key);if(e.push(t),u===0)return new b(this,e);u<=0?t=t.left:t=t.right}return new b(this,[])},o.remove=function(i){var s=this.find(i);return s?s.remove():this},o.get=function(i){for(var s=this._compare,t=this.root;t;){var e=s(i,t.key);if(e===0)return t.value;e<=0?t=t.left:t=t.right}};function b(i,s){this.tree=i,this._stack=s}var k=b.prototype;Object.defineProperty(k,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(k,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),k.clone=function(){return new b(this.tree,this._stack.slice())};function a(i,s){i.key=s.key,i.value=s.value,i.left=s.left,i.right=s.right,i._color=s._color,i._count=s._count}function l(i){for(var s,t,e,u,M=i.length-1;M>=0;--M){if(s=i[M],M===0){s._color=f;return}if(t=i[M-1],t.left===s){if(e=t.right,e.right&&e.right._color===S){if(e=t.right=d(e),u=e.right=d(e.right),t.right=e.left,e.left=t,e.right=u,e._color=t._color,s._color=f,t._color=f,u._color=f,c(t),c(e),M>1){var O=i[M-2];O.left===t?O.left=e:O.right=e}i[M-1]=e;return}else if(e.left&&e.left._color===S){if(e=t.right=d(e),u=e.left=d(e.left),t.right=u.left,e.left=u.right,u.left=t,u.right=e,u._color=t._color,t._color=f,e._color=f,s._color=f,c(t),c(e),c(u),M>1){var O=i[M-2];O.left===t?O.left=u:O.right=u}i[M-1]=u;return}if(e._color===f)if(t._color===S){t._color=f,t.right=_(S,e);return}else{t.right=_(S,e);continue}else{if(e=d(e),t.right=e.left,e.left=t,e._color=t._color,t._color=S,c(t),c(e),M>1){var O=i[M-2];O.left===t?O.left=e:O.right=e}i[M-1]=e,i[M]=t,M+1<i.length?i[M+1]=s:i.push(s),M=M+2}}else{if(e=t.left,e.left&&e.left._color===S){if(e=t.left=d(e),u=e.left=d(e.left),t.left=e.right,e.right=t,e.left=u,e._color=t._color,s._color=f,t._color=f,u._color=f,c(t),c(e),M>1){var O=i[M-2];O.right===t?O.right=e:O.left=e}i[M-1]=e;return}else if(e.right&&e.right._color===S){if(e=t.left=d(e),u=e.right=d(e.right),t.left=u.right,e.right=u.left,u.right=t,u.left=e,u._color=t._color,t._color=f,e._color=f,s._color=f,c(t),c(e),c(u),M>1){var O=i[M-2];O.right===t?O.right=u:O.left=u}i[M-1]=u;return}if(e._color===f)if(t._color===S){t._color=f,t.left=_(S,e);return}else{t.left=_(S,e);continue}else{if(e=d(e),t.left=e.right,e.right=t,e._color=t._color,t._color=S,c(t),c(e),M>1){var O=i[M-2];O.right===t?O.right=e:O.left=e}i[M-1]=e,i[M]=t,M+1<i.length?i[M+1]=s:i.push(s),M=M+2}}}}k.remove=function(){var i=this._stack;if(i.length===0)return this.tree;var s=new Array(i.length),t=i[i.length-1];s[s.length-1]=new w(t._color,t.key,t.value,t.left,t.right,t._count);for(var e=i.length-2;e>=0;--e){var t=i[e];t.left===i[e+1]?s[e]=new w(t._color,t.key,t.value,s[e+1],t.right,t._count):s[e]=new w(t._color,t.key,t.value,t.left,s[e+1],t._count)}if(t=s[s.length-1],t.left&&t.right){var u=s.length;for(t=t.left;t.right;)s.push(t),t=t.right;var M=s[u-1];s.push(new w(t._color,M.key,M.value,t.left,t.right,t._count)),s[u-1].key=t.key,s[u-1].value=t.value;for(var e=s.length-2;e>=u;--e)t=s[e],s[e]=new w(t._color,t.key,t.value,t.left,s[e+1],t._count);s[u-1].left=s[u]}if(t=s[s.length-1],t._color===S){var O=s[s.length-2];O.left===t?O.left=null:O.right===t&&(O.right=null),s.pop();for(var e=0;e<s.length;++e)s[e]._count--;return new v(this.tree._compare,s[0])}else if(t.left||t.right){t.left?a(t,t.left):t.right&&a(t,t.right),t._color=f;for(var e=0;e<s.length-1;++e)s[e]._count--;return new v(this.tree._compare,s[0])}else{if(s.length===1)return new v(this.tree._compare,null);for(var e=0;e<s.length;++e)s[e]._count--;var x=s[s.length-2];l(s),x.left===t?x.left=null:x.right=null}return new v(this.tree._compare,s[0])},Object.defineProperty(k,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(k,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(k,"index",{get:function(){var i=0,s=this._stack;if(s.length===0){var t=this.tree.root;return t?t._count:0}else s[s.length-1].left&&(i=s[s.length-1].left._count);for(var e=s.length-2;e>=0;--e)s[e+1]===s[e].right&&(++i,s[e].left&&(i+=s[e].left._count));return i},enumerable:!0}),k.next=function(){var i=this._stack;if(i.length!==0){var s=i[i.length-1];if(s.right)for(s=s.right;s;)i.push(s),s=s.left;else for(i.pop();i.length>0&&i[i.length-1].right===s;)s=i[i.length-1],i.pop()}},Object.defineProperty(k,"hasNext",{get:function(){var i=this._stack;if(i.length===0)return!1;if(i[i.length-1].right)return!0;for(var s=i.length-1;s>0;--s)if(i[s-1].left===i[s])return!0;return!1}}),k.update=function(i){var s=this._stack;if(s.length===0)throw new Error("Can't update empty node!");var t=new Array(s.length),e=s[s.length-1];t[t.length-1]=new w(e._color,e.key,i,e.left,e.right,e._count);for(var u=s.length-2;u>=0;--u)e=s[u],e.left===s[u+1]?t[u]=new w(e._color,e.key,e.value,t[u+1],e.right,e._count):t[u]=new w(e._color,e.key,e.value,e.left,t[u+1],e._count);return new v(this.tree._compare,t[0])},k.prev=function(){var i=this._stack;if(i.length!==0){var s=i[i.length-1];if(s.left)for(s=s.left;s;)i.push(s),s=s.right;else for(i.pop();i.length>0&&i[i.length-1].left===s;)s=i[i.length-1],i.pop()}},Object.defineProperty(k,"hasPrev",{get:function(){var i=this._stack;if(i.length===0)return!1;if(i[i.length-1].left)return!0;for(var s=i.length-1;s>0;--s)if(i[s-1].right===i[s])return!0;return!1}});function g(i,s){return i<s?-1:i>s?1:0}function p(i){return new v(i||g,null)}return Rt}var It,ye;function rr(){if(ye)return It;ye=1,It=w;var S=wt();function f(d,_){var c,v;if(_[0][0]<_[1][0])c=_[0],v=_[1];else if(_[0][0]>_[1][0])c=_[1],v=_[0];else{var o=Math.min(d[0][1],d[1][1]),n=Math.max(d[0][1],d[1][1]),r=Math.min(_[0][1],_[1][1]),h=Math.max(_[0][1],_[1][1]);return n<r?n-r:o>h?o-h:n-h}var b,k;d[0][1]<d[1][1]?(b=d[0],k=d[1]):(b=d[1],k=d[0]);var a=S(v,c,b);return a||(a=S(v,c,k),a)?a:k-v}function w(d,_){var c,v;if(_[0][0]<_[1][0])c=_[0],v=_[1];else if(_[0][0]>_[1][0])c=_[1],v=_[0];else return f(_,d);var o,n;if(d[0][0]<d[1][0])o=d[0],n=d[1];else if(d[0][0]>d[1][0])o=d[1],n=d[0];else return-f(d,_);var r=S(c,v,n),h=S(c,v,o);if(r<0){if(h<=0)return r}else if(r>0){if(h>=0)return r}else if(h)return h;if(r=S(n,o,v),h=S(n,o,c),r<0){if(h<=0)return r}else if(r>0){if(h>=0)return r}else if(h)return h;return v[0]-n[0]}return It}var At,we;function nr(){if(we)return At;we=1,At=h;var S=tr(),f=er(),w=wt(),d=rr();function _(b,k,a){this.slabs=b,this.coordinates=k,this.horizontal=a}var c=_.prototype;function v(b,k){return b.y-k}function o(b,k){for(var a=null;b;){var l=b.key,g,p;l[0][0]<l[1][0]?(g=l[0],p=l[1]):(g=l[1],p=l[0]);var i=w(g,p,k);if(i<0)b=b.left;else if(i>0)if(k[0]!==l[1][0])a=b,b=b.right;else{var s=o(b.right,k);if(s)return s;b=b.left}else{if(k[0]!==l[1][0])return b;var s=o(b.right,k);if(s)return s;b=b.left}}return a}c.castUp=function(b){var k=S.le(this.coordinates,b[0]);if(k<0)return-1;this.slabs[k];var a=o(this.slabs[k],b),l=-1;if(a&&(l=a.value),this.coordinates[k]===b[0]){var g=null;if(a&&(g=a.key),k>0){var p=o(this.slabs[k-1],b);p&&(g?d(p.key,g)>0&&(g=p.key,l=p.value):(l=p.value,g=p.key))}var i=this.horizontal[k];if(i.length>0){var s=S.ge(i,b[1],v);if(s<i.length){var t=i[s];if(b[1]===t.y){if(t.closed)return t.index;for(;s<i.length-1&&i[s+1].y===b[1];)if(s=s+1,t=i[s],t.closed)return t.index;if(t.y===b[1]&&!t.start){if(s=s+1,s>=i.length)return l;t=i[s]}}if(t.start)if(g){var e=w(g[0],g[1],[b[0],t.y]);g[0][0]>g[1][0]&&(e=-e),e>0&&(l=t.index)}else l=t.index;else t.y!==b[1]&&(l=t.index)}}}return l};function n(b,k,a,l){this.y=b,this.index=k,this.start=a,this.closed=l}function r(b,k,a,l){this.x=b,this.segment=k,this.create=a,this.index=l}function h(b){for(var k=b.length,a=2*k,l=new Array(a),g=0;g<k;++g){var p=b[g],i=p[0][0]<p[1][0];l[2*g]=new r(p[0][0],p,i,g),l[2*g+1]=new r(p[1][0],p,!i,g)}l.sort(function(D,q){var P=D.x-q.x;return P||(P=D.create-q.create,P)?P:Math.min(D.segment[0][1],D.segment[1][1])-Math.min(q.segment[0][1],q.segment[1][1])});for(var s=f(d),t=[],e=[],u=[],g=0;g<a;){for(var M=l[g].x,O=[];g<a;){var x=l[g];if(x.x!==M)break;g+=1,x.segment[0][0]===x.x&&x.segment[1][0]===x.x?x.create&&(x.segment[0][1]<x.segment[1][1]?(O.push(new n(x.segment[0][1],x.index,!0,!0)),O.push(new n(x.segment[1][1],x.index,!1,!1))):(O.push(new n(x.segment[1][1],x.index,!0,!1)),O.push(new n(x.segment[0][1],x.index,!1,!0)))):x.create?s=s.insert(x.segment,x.index):s=s.remove(x.segment)}t.push(s.root),e.push(M),u.push(O)}return new _(t,e,u)}return At}var zt,pe;function ir(){if(pe)return zt;pe=1,zt=_;var S=wt(),f=nr();function w(c){return-1}function d(c,v,o,n){function r(h){var b=v.castUp(h);if(b<0)return o;var k=c[b];return n?S(h,k[1],k[0]):S(h,k[0],k[1])}return r}function _(c,v){v=!!v;for(var o=c.length,n=0,r=0;r<o;++r)n+=c[r].length;if(n===0)return w;for(var h=new Array(n),b=0,r=0;r<o;++r)for(var k=c[r],a=k.length,l=a-1,g=0;g<a;l=g++)h[b++]=[k[l],k[g]];var p=f(h),i,s=p.slabs[0];if(s){for(;s.left;)s=s.left;var t=s.key;t[0][0]<t[1][0]?i=-1:i=1}else{var t=h[p.horizontal[0][0].index];t[0][1]<t[1][1]?i=1:i=-1}return v&&(i=-i),d(h,p,i,v)}return zt}var Tt,de;function or(){if(de)return Tt;de=1,Tt=w;var S=[0,0],f=[0,0];function w(d){for(var _=0,c=d[0],v=d.length,o=2;o<v;o++){var n=d[o-1],r=d[o];S[0]=c[0]-r[0],S[1]=c[1]-r[1],f[0]=c[0]-n[0],f[1]=c[1]-n[1],_+=S[0]*f[1]-S[1]*f[0]}return _/2}return Tt}var Nt,xe;function sr(){return xe||(xe=1,Nt=function(f){return f<0?-1:f>0?1:0}),Nt}var Ft,_e;function ar(){if(_e)return Ft;_e=1;var S=Jt(),f=ir(),w=or(),d=sr(),_=Math.abs;function c(l){for(var g=l.length,p=new Array(g),i=0;i<g;i++)p[i]=l[i].slice();return p}function v(l,g,p){this.vec=l,this.alpha=g||0,this.intersect=!!p}v.prototype={vec:null,next:null,next:null,prev:null,nextPoly:null,neighbor:null,intersect:null,entry:null,visited:!1,alpha:0,nextNonIntersection:function(){for(var g=this;g&&g.intersect;)g=g.next;return g},last:function(){for(var g=this;g.next&&g.next!==this;)g=g.next;return g},createLoop:function(){var g=this.last();g.prev.next=this,this.prev=g.prev},firstNodeOfInterest:function(){var g=this;if(g)do g=g.next;while(g!==this&&(!g.intersect||g.intersect&&g.visited));return g},insertBetween:function(g,p){for(var i=g;i!==p&&i.alpha<this.alpha;)i=i.next;this.next=i,this.prev=i.prev,this.prev&&(this.prev.next=this),this.next.prev=this}};function o(l){for(var g=l.length,p,i,s=0;s<g;s++){var t=l[s];p?(i.next=new v(t),i.next.prev=i,i=i.next):i=p=new v(t)}return p}function n(l,g){var p=l[0]-g[0],i=l[1]-g[1];return Math.sqrt(p*p+i*i)}function r(l){for(var g=l.length-1;g--;){var p=l[g],i=l[g+1];p[0]===i[0]&&p[1]===i[1]&&l.splice(g,1)}return l}function h(l,g){var p,i,s=l.last();s.next=new v(l.vec,s),s.next.prev=s;var t=g.last();t.next=new v(g.vec,t),t.next.prev=t;var e=!1;for(p=l;p.next;p=p.next)if(!p.intersect){for(i=g;i.next;i=i.next)if(!i.intersect){var u=p.vec,M=p.next.nextNonIntersection().vec,O=i.vec,x=i.next.nextNonIntersection().vec,D=S(u,M,O,x);if(D&&D!==!0){e=!0;var q=new v(D,n(u,D)/n(u,M),!0),P=new v(D,n(O,D)/n(O,x),!0);q.neighbor=P,P.neighbor=q,q.insertBetween(p,p.next.nextNonIntersection()),P.insertBetween(i,i.next.nextNonIntersection())}}}return e}function b(l,g,p,i,s){var t,e,u=p(l.vec)<0;for(s==="and"&&(u=!u),t=l;t.next;t=t.next)t.intersect&&(t.entry=u,u=!u);var M=i(g.vec)>0;for(s==="or"&&(M=!M),e=g;e.next;e=e.next)e.intersect&&(e.entry=M,M=!M)}function k(l,g){l.createLoop(),g.createLoop();for(var p,i=[],s;(p=l.firstNodeOfInterest())!==l;){for(s=[];!p.visited;p=p.neighbor){s.push(p.vec);for(var t=p.entry;;)if(p.visited=!0,p=t?p.next:p.prev,p.intersect){p.visited=!0;break}else s.push(p.vec)}i.push(r(s))}return i}function a(l,g,p){var i=o(l),s=o(g),t=f([g]),e=f([l]),u,M=h(i,s);if(M)b(i,s,t,e,p),u=k(i,s);else{var O=t(l[0])<0,x=e(g[0])<0;switch(u=[],p){case"or":!O&&!x?(u.push(c(l)),u.push(c(g))):O?u.push(c(g)):x&&u.push(c(l));break;case"and":if(O)u.push(c(l));else if(x)u.push(c(g));else throw new Error("woops");break;case"not":var D=c(l),q=c(g),P=w(D),R=w(q);d(P)===d(R)&&(x?q.reverse():O&&D.reverse()),u.push(D),_(P)>_(R)?u.push(q):u.unshift(q);break}}return u}return Ft=a,Ft}var Et,be;function fr(){if(be)return Et;be=1,Et=S;function S(f){for(var w=f.length,d=f[f.length-1],_=w,c=w-2;c>=0;--c){var v=d,o=f[c];d=v+o;var n=d-v,r=o-n;r&&(f[--_]=d,d=r)}for(var h=0,c=_;c<w;++c){var v=f[c],o=d;d=v+o;var n=d-v,r=o-n;r&&(f[h++]=r)}return f[h++]=d,f.length=h,f}return Et}var Lt,ke;function ur(){if(ke)return Lt;ke=1,Lt=w;var S=wt()[3];function f(d,_,c,v){for(var o=0;o<2;++o){var n=d[o],r=_[o],h=Math.min(n,r),b=Math.max(n,r),k=c[o],a=v[o],l=Math.min(k,a),g=Math.max(k,a);if(g<h||b<l)return!1}return!0}function w(d,_,c,v){var o=S(d,c,v),n=S(_,c,v);if(o>0&&n>0||o<0&&n<0)return!1;var r=S(c,d,_),h=S(v,d,_);return r>0&&h>0||r<0&&h<0?!1:o===0&&n===0&&r===0&&h===0?f(d,_,c,v):!0}return Lt}var Ct,Se;function hr(){if(Se)return Ct;Se=1,Ct=c;var S=Vt(),f=je(),w=Be(),d=fr(),_=ur();function c(v,o,n,r){if(!_(v,o,n,r))return[[0],[0],[0]];var h=f([n[1]],[-r[1]]),b=f([-n[0]],[r[0]]),k=f(f(w(b,v[1]),w(b,-o[1])),f(w(h,v[0]),w(h,-o[0]))),a=f(S(-v[0],o[1]),S(v[1],o[0])),l=f(S(-n[0],r[1]),S(n[1],r[0])),g=f(f(w(l,v[0]),w(l,-o[0])),f(w(a,-n[0]),w(a,r[0]))),p=f(f(w(l,v[1]),w(l,-o[1])),f(w(a,-n[1]),w(a,r[1])));return[d(g),d(p),d(k)]}return Ct}var jt,De;function lr(){if(De)return jt;De=1,jt=S;function S(f){var w=0,d=f.length;switch(d){case 1:w=f[0];break;case 2:w=f[0]+f[1];break;case 3:w=f[0]+f[1]+f[2];break;case 4:w=f[0]+f[1]+f[2]+f[3];break;default:for(var _=0;_<d;_++)w+=f[_]}return w}return jt}var Bt,qe;function cr(){if(qe)return Bt;qe=1;var S=hr(),f=lr();Bt=n;function w(r,h){return r[0]===h[0]&&r[1]===h[1]}var d=[0,0],_=[0,0],c=[0,0],v=[0,0];function o(r,h){Array.isArray(r)?(h[0]=r[0],h[1]=r[1]):(h[0]=r.x,h[1]=r.y)}function n(r,h){for(var b={},k=r.length,a=[],l=0;l<k;l++){var g=r[l],p=r[(l+1)%k];o(g,c),o(p,v);for(var i=0;i<k;i++)if(l!==i){var s=r[i],t=r[(i+1)%k];if(o(s,d),o(t,_),!(w(d,c)||w(d,v)||w(_,c)||w(_,v))){var e=S(c,v,d,_),u=e[2];if(!(u.length===1&&!u[0])){var M=f(e[2]);if(e[0]=f(e[0])/M,e[1]=f(e[1])/M,e.pop(),!(w(e,c)||w(e,v)||w(e,d)||w(e,_))){var O=e+"",x=!b[O];x&&(b[O]=!0);var D=x;h&&(D=h(e,l,g,p,i,s,t,x)),D&&a.push(e)}}}}}return a}return Bt}(function(S){if(typeof Le<"u")var f=Qe(),w=Jt(),d=Ge(),_=ar(),c=cr();var v=Math.PI,o=v*2,n=function(a){return a<0&&(a+=o),a},r=function(a){return Object.prototype.toString.call(a)==="[object Array]"},h=function(a){return typeof a=="function"},b=function(a){return typeof a<"u"};function k(a){if(a instanceof k)return a;if(!(this instanceof k))return new k(a);Array.isArray(a)||(a=a?[a]:[]),this.points=a.map(function(l){if(Array.isArray(l))return f.fromArray(l);if(l instanceof f)return l;if(typeof l.x<"u"&&typeof l.y<"u")return f(l.x,l.y)})}k.prototype={each:function(a){for(var l=0;l<this.points.length&&a.call(this,this.point(l-1),this.point(l),this.point(l+1),l)!==!1;l++);return this},insert:function(a,l){this.points.splice(l,0,a)},point:function(a){var l=a%this.points.length;return l<0&&(l=this.points.length+l),this.points[l]},dedupe:function(a){var l={},g=this.points.filter(function(p){var i=p.x+":"+p.y;if(!l[i])return l[i]=!0,!0});return a?new k(g):(this.points=g,this)},remove:function(a){return typeof a=="number"?this.points.splice(a,1):this.points=this.points.filter(function(l){return l!==a}),this},clean:function(a){var l=this.point(-1),g=this.points.filter(function(p){var i=!1;return l.equal(p)||(i=!0),l=p,i});return a?new k(g):(this.points=g,this)},simplify:function(){var a=function(u){return Math.round(u*1e4)/1e4},l=function(u,M,O){var x=u.x*(M.y-O.y)+M.x*(O.y-u.y)+O.x*(u.y-M.y);return a(x)===0};this.points=this.points.filter(Boolean);for(var g=[],p=0;p<this.points.length;p++){var i=this.point(p-1),s=this.point(p+1),t=this.point(p),e=t.subtract(i,!0).angleTo(t.subtract(s,!0));!l(i,t,s)&&a(e)&&g.push(t)}return this.points=g,this},winding:function(){return this.area()>0},rewind:function(a){a=!!a;var l=this.winding();return l!==a&&this.points.reverse(),this},area:function(){var a=0,l=this.point(0);return this.each(function(g,p,i,s){if(!(s<2)){var t=l.subtract(p,!0),e=l.subtract(g,!0);a+=t.x*e.y-t.y*e.x}}),a/2},closestPointTo:function(a){var l=this.points.length,g=1/0,p=null,i=0,s=!1,t;for(t=0;t<l;t++){var e=this.point(t-1),u=this.point(t);if(!e.equal(u)){var M=u.subtract(e,!0),O=a.subtract(e,!0),x=O.dot(M),D=M.dot(M),q=Math.min(Math.max(x/D,0),1),P=M.multiply(q).add(e),R=a.subtract(P,!0).lengthSquared();R<g&&(p=P,i=t,s=q===0||q===1,g=R)}}return p.prev=this.point(i-1),p.next=this.point(i+1),s&&(p.current=this.point(i)),p},center:function(){var a=this.aabb();return f(a.x+a.w/2,a.y+a.h/2)},scale:function(a,l,g){var p=this;g&&(p=this.clone()),l||(l=p.center()),p.each(function(s,t){t.multiply(a)});var i=l.multiply(a,!0).subtract(l);return p.each(function(s,t){t.subtract(i)}),p},containsPoint:function(a){var l=!1;return this.each(function(g,p,i){(g.y<=a.y&&a.y<p.y||p.y<=a.y&&a.y<g.y)&&a.x<(p.x-g.x)*(a.y-g.y)/(p.y-g.y)+g.x&&(l=!l)}),l},containsPolygon:function(a){r(a)&&(a=new k(a));for(var l=0;l<a.points.length;l++)if(!this.containsPoint(a.points[l]))return!1;for(var l=0;l<this.points.length;l++)for(var g=this.line(l),p=0;p<a.points.length;p++){var i=a.line(p),s=w(g[0],g[1],i[0],i[1]);if(s&&s!==!0)return!1}return!0},aabb:function(){if(this.points.length<2)return{x:0,y:0,w:0,h:0};var a,l,g,p,i=this.point(1);return l=a=i.x,g=p=i.y,this.each(function(s,t){t.x>l&&(l=t.x),t.x<a&&(a=t.x),t.y>g&&(g=t.y),t.y<p&&(p=t.y)}),{x:a,y:p,w:l-a,h:g-p}},offset:function(a,l){var g=[];this.rewind(!1).simplify().each(function(t,e,u,M){var O=e.subtract(t,!0).normalize(),x=e.subtract(u,!0).normalize(),D=a/Math.sin(Math.acos(O.dot(x))/2),q=O.add(x,!0).normalize().multiply(D,!0),P=n(O.angleTo(x)),R=O.perpDot(x)<0?e.add(q,!0):e.subtract(q,!0);(P>o*.75||P<o*.25)&&(R.computeSegments=P,e.color="white",e.radius=3),R.point=e,g.push(R)});var p=function(t,e){var u=t.subtract(e,!0),M=f(1,0).angleTo(u),O=f(a,0).rotate(M+Math.PI/2);O.add(e);var x=O.add(u,!0),D=new d(O.x,O.y,x.x,x.y),q=t.add(u,!0);return new d(t.x,t.y,q.x,q.y),D},i=k(g),s=[];return i.each(function(t,e,u,M){var O=w(e,e.point,u,u.point);if(O){var x=i.point(M-2),D=i.point(M+2);p(x.point,t.point);var q=p(t.point,e.point);p(e.point,u.point);var P=p(u.point,D.point),R=q.intersect(P);R.color="yellow",R.point=e.point,s.push(R)}else s.push(e)}),s.length?k(s):i},line:function(a){return[this.point(a),this.point(a+1)]},lines:function(a){var l=0;return this.each(function(g,p,i){a(p,i,l++)}),this},selfIntersections:function(){var a=[];return c(this.points,function(l,g,p,i,s,t,e,u){if(u){var M=f.fromArray(l);return a.push(M),M.s=g+p.subtract(M,!0).length()/p.subtract(i,!0).length(),M.b=s+t.subtract(M,!0).length()/t.subtract(e,!0).length(),M.si=g,M.bi=s,!1}}),k(a)},pruneSelfIntersections:function(){var a=this.selfIntersections(),l=function(R,A,T,C){return R>T&&A<C},g=function(R,A,T,C){return R<T&&A>C},p=function(R,A,T,C){return R<T&&T<A&&C>A||T<A&&A<C&&R<T};function i(R,A){this.value=R,this.depth=this.depth,this.children=[]}var s=this.point(0).clone();s.s=0,s.b=this.points.length-1+.99;var t=new i(s),e=t,u=[s];a.each(function(R,A,T){console.log("belongTo:",l(e.s,e.b,A.s,A.b),"contain:",g(e.s,e.b,A.s,A.b),"interfere:",p(e.s,e.b,A.s,A.b)),u.push(A),e=A});var M=[];if(u.length<2)return[this];u.sort(function(R,A){return R.s-A.s});for(var O=0;O<u.length;O+=2){var x=[],D=O<u.length-1?u[O+1]:null;if(D){for(var q=Math.floor(u[O].s);q<=Math.floor(D.s);q++)x.push(this.point(q));x.push(D);for(var q=Math.floor(D.b+1);q<=Math.floor(u[O].b);q++)x.push(this.point(q))}else{x.push(u[O]);for(var P=Math.floor(u[O].s+1);P<=Math.floor(u[O].b);P++)x.push(this.point(P))}M.push(new k(x))}return M},get length(){return this.points.length},clone:function(){var a=[];return this.each(function(l,g){a.push(g.clone())}),new k(a)},rotate:function(a,l,g){l=l||this.center();var p=g?this.clone():this;return p.each(function(i,s){s.subtract(l).rotate(a).add(l)})},translate:function(a,l){var g=l?this.clone():this;return g.each(function(p,i){i.add(a)}),g},equal:function(a){for(var l=a.length;l--;)if(!this.point(l).equal(a.point(l)))return!1;return!0},containsCircle:function(a,l,g){var p=new f(a,l);if(!this.containsPoint(p))return!1;var i=this.closestPointTo(p);if(i.distance(p)>=g)return!0},contains:function(a){if(!a)return!1;if(b(a.radius)&&a.position){var l;return h(a.radius)?l=a.radius():l=a.radius,this.containsCircle(a.position.x,a.position.y,l)}else if(typeof a.points<"u"){var g;return(h(a.containsPolygon)||r(a.points))&&(g=a.points),this.containsPolygon(g)}else{if(b(a.x1)&&b(a.x2)&&b(a.y1)&&b(a.y2))return this.containsPolygon([new f(a.x1,a.y1),new f(a.x2,a.y1),new f(a.x2,a.y2),new f(a.x1,a.y2)]);if(b(a.x)&&b(a.y)){var p,i;return b(a.w)&&b(a.h)&&(p=a.x+a.w,i=a.y+a.h),b(a.width)&&b(a.height)&&(p=a.x+a.width,i=a.y+a.height),this.containsPolygon([new f(a.x,a.y),new f(p,a.y),new f(p,i),new f(a.x,i)])}}return!1},union:function(a){return k(_(this.toArray(),a.toArray(),"or")[0])},cut:function(a){return _(this.toArray(),a.toArray(),"not").map(function(l){return new k(l)})},intersect:function(a){return _(this.toArray(),a.toArray(),"and").map(function(l){return new k(l)})},toArray:function(){for(var a=this.length,l=Array(a),g=0;g<a;g++)l[g]=this.points[g].toArray();return l},toString:function(){return this.points.join(",")}},S.exports&&(S.exports=k),typeof window<"u"&&(window.Polygon=k)})(Ce);var vr=Ce.exports;const Xt=Ke(vr);class gr{constructor(f,w=[],d=[]){N(this,"canvas");N(this,"ctx");N(this,"interval",0);N(this,"displayMeasurements",!1);N(this,"windowImage",new Image);N(this,"singleDoorImage",new Image);N(this,"doubleDoorImage",new Image);N(this,"stairsImage",new Image);N(this,"windowDimensions",{width:0,height:0});N(this,"centerPosition",{x:0,y:0});N(this,"canvasOffset",{x:0,y:0});N(this,"objects",[{type:B.Door,position:{x:0,y:0},rotation:0}]);N(this,"testRoom",{quality:0,lines:[{start:{x:-5,y:-5},end:{x:-5,y:5}},{start:{x:-5,y:5},end:{x:5,y:5}},{start:{x:5,y:5},end:{x:5,y:-5}},{start:{x:5,y:-5},end:{x:-5,y:-5}}],position:{x:0,y:0},rotation:0,type:B.Room,name:"Test room"});N(this,"rooms",[this.testRoom]);N(this,"minimumPointSize",20);N(this,"pointSize",this.minimumPointSize);N(this,"lineWidth",1/3*this.pointSize);N(this,"scale",1);N(this,"halfPointSize",this.pointSize/2);N(this,"transformFakeToDrawable",(f,w=rt.Center,d=rt.Center)=>{let _=0,c=0;return w===rt.Right&&(_=this.pointSize),w===rt.Center&&(_=this.halfPointSize),d===rt.Bottom&&(c=this.pointSize),d===rt.Center&&(c=this.halfPointSize),{x:f.x*this.pointSize+this.canvasOffset.x-this.halfPointSize+_,y:-f.y*this.pointSize+this.canvasOffset.y-this.halfPointSize+c}});N(this,"transformRealToFake",f=>{const w={x:f.x-this.canvasOffset.x,y:this.canvasOffset.y-f.y};return{x:Math.round(w.x/this.pointSize),y:Math.round(w.y/this.pointSize)}});this.canvas=f,this.ctx=f.getContext("2d"),this.objects=w,this.rooms=d,this.windowImage.src="window-path.svg",this.singleDoorImage.src="single-door.svg",this.doubleDoorImage.src="double-doors.svg",this.stairsImage.src="stairs.svg",console.log(`Floor Renderer constructor! ${this.canvas} ... ${this.ctx}`)}dpiFix(f,w){this.windowDimensions={width:f,height:w};const d=f,_=w,c=Math.ceil(window.devicePixelRatio);this.pointSize=20,this.canvas.width=d*c,this.canvas.height=_*c,this.canvas.style.width=`${d}px`,this.canvas.style.height=`${_}px`,this.ctx.scale(c,c),this.setCenter(),this.redraw()}setCenter(){let f=this.canvas.clientWidth,w=this.canvas.clientHeight;this.centerPosition={x:f/2,y:w/2}}redraw(){const f=this.ctx;f&&(f.clearRect(0,0,1e4,1e4),this.drawGrid(this.windowDimensions.width,this.windowDimensions.height),this.setCenter(),this.rooms.forEach(w=>{this.drawRoom(w)}),this.drawObjects())}drawRoom(f){const w=this.ctx;this.colorRoom(f),w.beginPath(),f.lines.forEach(h=>this.drawLine(h)),w.strokeStyle="black",w.lineWidth=this.lineWidth,w.stroke();const d=new Xt(f.lines.map(h=>h.start)),_=d.area();w.fillStyle="white";const c=d.center(),v={x:c.x,y:c.y},o=this.transformFakeToDrawable(v);if(this.displayMeasurements){f.lines.forEach(l=>this.displayLineDistance(l,void 0,d));const h={x:c.x,y:c.y},b=this.transformFakeToDrawable(h),k=`${Math.abs(_/(this.pointSize*this.pointSize)*100).toFixed(1)}m`,a=this.ctx.measureText(k);w.fillText(k,b.x,b.y),w.font=`${this.halfPointSize*.8}px Arial`,w.fillText("2",b.x+a.actualBoundingBoxRight+5,b.y-a.fontBoundingBoxAscent)}const n=f.name,r=this.ctx.measureText(n);w.font=`${this.pointSize*.8}px Arial`,w.fillText(f.name,o.x-r.width/2,o.y)}colorRoom(f){if(f.lines.length<=2)return;const w=f.lines[0].start,d=f.lines[f.lines.length-2].start,_=this.transformFakeToDrawable(w),c=this.transformFakeToDrawable(d),v=this.ctx.createLinearGradient(_.x,_.y,c.x,c.y);v.addColorStop(0,"rgb(112, 171, 153)"),v.addColorStop(1,"rgb(101, 164, 145)"),this.ctx.fillStyle=f.quality===0?"rgba(0,0,0, .5)":v,this.ctx.beginPath(),this.ctx.moveTo(_.x,_.y),f.lines.forEach(({start:o,end:n})=>{const r=this.transformFakeToDrawable(n);this.ctx.lineTo(r.x,r.y)}),this.ctx.moveTo(_.x,_.y),this.ctx.closePath(),this.ctx.fill()}drawLine(f){const w=this.transformFakeToDrawable(f.start),d=this.transformFakeToDrawable(f.end);this.ctx.lineCap="round",this.ctx.moveTo(w.x,w.y),this.ctx.lineTo(d.x,d.y)}displayLineDistance(f,w=void 0,d=void 0){const{start:_,end:c}=f;let v=this.getLineDirection(f),o=0,n=0;const r=Math.sqrt(Math.abs(_.x-c.x)**2+Math.abs(_.y-c.y)**2),h={x:(c.x+_.x)/2,y:(c.y+_.y)/2},b=this.transformFakeToDrawable(h);if(d){const{x:a,y:l}=d.center(),g={x:a,y:l};v=this.getLineDirection({start:h,end:g})}o=v.x===0?0:Math.sign(v.x)*this.pointSize,n=v.y===0?0:-Math.sign(v.y)*this.halfPointSize*1.25;let k=this.ctx;k.font=`${this.halfPointSize}px Verdana`,k.textAlign="center",k.textBaseline="middle",k.fillText(`${(r/2).toFixed(1)}m`,(w==null?void 0:w.x)??b.x+o,(w==null?void 0:w.y)??b.y+n)}getLineDirection(f){const{start:w,end:d}=f;return{x:d.x-w.x,y:d.y-w.y}}drawObjects(){let f=this.ctx;if(f)for(let w of this.objects){const d=w.type===B.Stairs?6:2.5;w.rotation==0,w.rotation==.5,w.rotation==1,w.rotation==1.5;const _=this.transformFakeToDrawable(w.position),c=w.rotation;f.save(),f.translate(_.x-this.pointSize,_.y-this.pointSize),f.rotate(Math.PI*c);let v=this.singleDoorImage;switch(w.type){case B.Door:v=this.singleDoorImage;break;case B.Window:v=this.windowImage;break;case B.DoubleDoor:v=this.doubleDoorImage;break;case B.Stairs:v=this.stairsImage;break}f.drawImage(v,-d/2*this.pointSize,-d/2*this.pointSize,d*this.pointSize,d*this.pointSize),f.restore()}}drawGrid(f,w){const d=this.ctx,_=this.pointSize,c=f/_,v=w/_,o=this.pointSize/100;this.ctx.lineWidth=o*2,this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)";for(let n=-c;n<c;n++){const r=n*_+this.canvasOffset.x+this.pointSize-o/2;d.beginPath(),d.moveTo(r,0),d.lineTo(r,w),d.stroke()}for(let n=-v;n<v;n++){const r=n*_+this.canvasOffset.y+this.pointSize/2-o/2;d.beginPath(),d.moveTo(0,r),d.lineTo(f,r),d.stroke()}}}function Me(S){let f,w,d,_,c,v,o,n,r,h,b,k,a,l,g=S[8]&&Pe(S);return{c(){f=W("div"),g&&g.c(),w=ot(),d=W("div"),_=W("img"),v=ot(),o=W("div"),n=W("img"),this.h()},l(p){f=U(p,"DIV",{id:!0,style:!0,class:!0});var i=Q(f);g&&g.l(i),w=st(i),d=U(i,"DIV",{class:!0});var s=Q(d);_=U(s,"IMG",{src:!0,class:!0}),s.forEach(E),v=st(i),o=U(i,"DIV",{class:!0});var t=Q(o);n=U(t,"IMG",{src:!0,class:!0}),t.forEach(E),i.forEach(E),this.h()},h(){var p;Kt(_.src,c="./rotate.svg")||L(_,"src",c),L(_,"class","svelte-1vxmyrg"),L(d,"class","button svelte-1vxmyrg"),Kt(n.src,r="./trash.svg")||L(n,"src",r),L(n,"class","svelte-1vxmyrg"),L(o,"class","button svelte-1vxmyrg"),L(f,"id","toolbar"),it(f,"left",S[5].x-((p=S[4])==null?void 0:p.clientWidth)/2+"px"),it(f,"top",S[5].y+2*S[9]+"px"),it(f,"transition","none"),L(f,"class","svelte-1vxmyrg")},m(p,i){Z(p,f,i),g&&g.m(f,null),J(f,w),J(f,d),J(d,_),J(f,v),J(f,o),J(o,n),S[28](f),k=!0,a||(l=[H(_,"click",S[26]),H(n,"click",S[27])],a=!0)},p(p,i){var s;p[8]?g?g.p(p,i):(g=Pe(p),g.c(),g.m(f,w)):g&&(g.d(1),g=null),(!k||i[0]&48)&&it(f,"left",p[5].x-((s=p[4])==null?void 0:s.clientWidth)/2+"px"),(!k||i[0]&32)&&it(f,"top",p[5].y+2*p[9]+"px")},i(p){k||(p&&Wt(()=>{k&&(b&&b.end(1),h=Fe(f,gt,{}),h.start())}),k=!0)},o(p){h&&h.invalidate(),p&&(b=Ee(f,gt,{})),k=!1},d(p){p&&E(f),g&&g.d(),S[28](null),p&&b&&b.end(),a=!1,ze(l)}}}function Pe(S){let f,w,d;return{c(){f=W("input")},l(_){f=U(_,"INPUT",{})},m(_,c){Z(_,f,c),Gt(f,S[8].name),w||(d=H(f,"input",S[25]),w=!0)},p(_,c){c[0]&256&&f.value!==_[8].name&&Gt(f,_[8].name)},d(_){_&&E(f),w=!1,d()}}}function yr(S){let f,w,d,_,c;Wt(S[20]);let v=S[5]&&(S[2]||S[8])&&Me(S);return{c(){f=W("canvas"),w=ot(),v&&v.c(),d=Zt(),this.h()},l(o){f=U(o,"CANVAS",{class:!0}),Q(f).forEach(E),w=st(o),v&&v.l(o),d=Zt(),this.h()},h(){L(f,"class","svelte-1vxmyrg")},m(o,n){Z(o,f,n),S[21](f),Z(o,w,n),v&&v.m(o,n),Z(o,d,n),_||(c=[H(window,"resize",S[20]),H(f,"click",S[11]),H(f,"mousedown",S[22]),H(f,"mouseenter",S[23]),H(f,"mousemove",S[10]),H(f,"mouseup",S[24])],_=!0)},p(o,n){o[5]&&(o[2]||o[8])?v?(v.p(o,n),n[0]&292&&m(v,1)):(v=Me(o),v.c(),m(v,1),v.m(d.parentNode,d)):v&&(Te(),at(v,1,1,()=>{v=null}),Ne())},i(o){m(v)},o(o){at(v)},d(o){o&&(E(f),E(w),E(d)),S[21](null),v&&v.d(o),_=!1,ze(c)}}}const wr=20;let Oe=10;function pr(S,f,w){let d,_,c,v,o,n;K(S,ut,I=>w(16,d=I)),K(S,nt,I=>w(17,_=I)),K(S,lt,I=>w(2,c=I)),K(S,ct,I=>w(8,v=I)),K(S,vt,I=>w(18,o=I)),K(S,yt,I=>w(19,n=I));let r,h=!1,b,k={x:0,y:0},a,l,g,p,i=wr,s={x:0,y:0},t=s;function e(I){if(w(15,s={x:I.clientX,y:I.clientY}),I.button==1||I.button==1&2){let z=I.clientX-t.x,F=I.clientY-t.y;w(14,r.canvasOffset.x+=z,r),w(14,r.canvasOffset.y+=F,r),w(7,t={...s}),$(lt,c=void 0,c)}h&&O()}He(async()=>{w(14,r=new gr(a)),w(14,r.rooms=[r.testRoom],r),l=r.ctx,r.dpiFix(p,g),w(14,r.canvasOffset=r.centerPosition,r),r.redraw()});function u(I){const z=r.transformRealToFake({x:I.clientX,y:I.clientY});if(!(I.movementX>0||I.movementY>0))if(n===tt.Drawing){const F=o.length,Y=o[F-1]??{start:{x:z.x,y:z.y},end:{x:z.x,y:z.y}};if(console.log(o.length),o.includes(Y)||vt.update(j=>(j.push(Y),j)),JSON.stringify(z)!==JSON.stringify(Y.start)){if(Y.end=z,JSON.stringify(Y.end)===JSON.stringify(o[0].start)){const G=new Xt(o.map(pt=>pt.end)).center(),Xe={lines:[...o],quality:0,position:{x:G.x,y:G.y},rotation:0,type:B.Room,name:"No Name"};$(vt,o=[],o),$(yt,n=tt.None,n),ut.update(pt=>[...pt,Xe])}else vt.update(j=>(j.push({start:{x:z.x,y:z.y},end:{x:z.x,y:z.y}}),j));return}}else{const F=[{x:z.x-2,y:z.y-2},{x:z.x-2,y:z.y+2},{x:z.x+2,y:z.y+2},{x:z.x+2,y:z.y-2},{x:z.x-2,y:z.y-2}],X=new Xt(F),Y=r.objects.findLast(j=>X.contains({x:j.position.x,y:j.position.y,w:0,h:0}));if($(lt,c=Y,c),w(5,k=s),!Y){const j=r.rooms.findLast(G=>X.contains({x:G.position.x,y:G.position.y,w:0,h:0}));$(ct,v=j,v)}}}function M(){const I=o[o.length-1];l&&I&&(r.getLineDirection(I),r.transformFakeToDrawable(I.start),I.end=r.transformRealToFake(s),l.beginPath(),r.drawLine(I),l.lineWidth=Oe,l.stroke(),l.fillStyle="black",r.displayLineDistance(I,{x:s.x+i,y:s.y-i}))}function O(){const I=c;I&&(I.position=r.transformRealToFake({x:s.x+i,y:s.y+i}),w(5,k=s))}function x(){const I=c;I&&(I.rotation+=.5,I.rotation===2&&(I.rotation=0),r==null||r.redraw())}function D(){const I=v;I&&ut.update(F=>{const X=F.indexOf(I);return F.splice(X,1),F});const z=c;z&&nt.update(F=>{const X=F.indexOf(z);return F.splice(X,1),F}),$(ct,v=void 0,v),$(lt,c=void 0,c)}function q(){w(0,g=window.innerHeight),w(1,p=window.innerWidth)}function P(I){Qt[I?"unshift":"push"](()=>{a=I,w(6,a)})}const R=I=>{w(7,t={x:I.clientX,y:I.clientY}),w(3,h=I.button===0)},A=I=>w(7,t={x:I.clientX,y:I.clientY}),T=()=>{w(3,h=!1)};function C(){v.name=this.value,ct.set(v)}const et=()=>x(),V=()=>D();function ht(I){Qt[I?"unshift":"push"](()=>{b=I,w(4,b)})}return S.$$.update=()=>{if(S.$$.dirty[0]&147456&&r&&w(14,r.objects=_,r),S.$$.dirty[0]&81920&&r&&w(14,r.rooms=d,r),S.$$.dirty[0]&16387&&g&&r.dpiFix(p,g),S.$$.dirty[0]&16387&&p&&r.dpiFix(p,g),S.$$.dirty[0]&311296&&s&&(r==null||r.redraw(),M(),r)){const I=r.ctx,z=o[0];if(z){I.strokeStyle="orange",I.lineWidth=Oe;const F=r.transformFakeToDrawable(z.start);I.beginPath(),I.moveTo(F.x,F.y),o.forEach(X=>r.drawLine(X)),I.stroke()}}S.$$.dirty[0]&16384&&(r==null||r.redraw()),S.$$.dirty[0]&540672&&n&&(r==null||r.redraw()),S.$$.dirty[0]&16388&&c&&(r==null||r.redraw())},[g,p,c,h,b,k,a,t,v,i,e,u,x,D,r,s,d,_,o,n,q,P,R,A,T,C,et,V,ht]}class dr extends Ut{constructor(f){super(),Ht(this,f,pr,yr,Yt,{},null,[-1,-1])}}function Re(S,f,w){const d=S.slice();return d[10]=f[w],d[12]=w,d}function Ie(S){let f,w,d,_;return{c(){f=W("div"),this.h()},l(c){f=U(c,"DIV",{id:!0,class:!0}),Q(f).forEach(E),this.h()},h(){L(f,"id","drawing-indicator"),L(f,"class","svelte-qwaka0")},m(c,v){Z(c,f,v),_=!0},i(c){_||(c&&Wt(()=>{_&&(d&&d.end(1),w=Fe(f,gt,{}),w.start())}),_=!0)},o(c){w&&w.invalidate(),c&&(d=Ee(f,gt,{})),_=!1},d(c){c&&E(f),c&&d&&d.end()}}}function Ae(S){let f,w,d,_,c;return{c(){f=W("div"),w=W("button"),d=ot(),this.h()},l(v){f=U(v,"DIV",{class:!0});var o=Q(f);w=U(o,"BUTTON",{class:!0,style:!0}),Q(w).forEach(E),d=st(o),o.forEach(E),this.h()},h(){L(w,"class","button svelte-qwaka0"),it(w,"mask-image","url('"+S[10].icon+"')"),L(f,"class","button-container svelte-qwaka0")},m(v,o){Z(v,f,o),J(f,w),J(f,d),_||(c=H(w,"click",S[10].action),_=!0)},p(v,o){S=v},d(v){v&&E(f),_=!1,c()}}}function xr(S){let f,w,d=S[0]===tt.Drawing&&Ie(),_=re(S[1]),c=[];for(let v=0;v<_.length;v+=1)c[v]=Ae(Re(S,_,v));return{c(){f=W("div"),d&&d.c(),w=ot();for(let v=0;v<c.length;v+=1)c[v].c();this.h()},l(v){f=U(v,"DIV",{id:!0,class:!0});var o=Q(f);d&&d.l(o),w=st(o);for(let n=0;n<c.length;n+=1)c[n].l(o);o.forEach(E),this.h()},h(){L(f,"id","container"),L(f,"class","svelte-qwaka0")},m(v,o){Z(v,f,o),d&&d.m(f,null),J(f,w);for(let n=0;n<c.length;n+=1)c[n]&&c[n].m(f,null)},p(v,[o]){if(v[0]===tt.Drawing?d?o&1&&m(d,1):(d=Ie(),d.c(),m(d,1),d.m(f,w)):d&&(Te(),at(d,1,1,()=>{d=null}),Ne()),o&2){_=re(v[1]);let n;for(n=0;n<_.length;n+=1){const r=Re(v,_,n);c[n]?c[n].p(r,o):(c[n]=Ae(r),c[n].c(),c[n].m(f,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=_.length}},i(v){m(d)},o(v){at(d)},d(v){v&&E(f),d&&d.d(),Ve(c,v)}}}function _r(S,f,w){let d,_,c;K(S,nt,a=>w(2,d=a)),K(S,ut,a=>w(3,_=a)),K(S,yt,a=>w(0,c=a));const v=[{icon:"./point.svg",action:o},{icon:"./doors.svg",action:()=>n(!1)},{icon:"./double-doors.svg",action:()=>n(!0)},{icon:"./stairs.svg",action:h},{icon:"./window.svg",action:r},{icon:"./import.svg",action:b},{icon:"./export.svg",action:k}];function o(){$(yt,c=c===tt.Drawing?tt.None:tt.Drawing,c)}function n(a=!1){nt.update(l=>(l.push({position:{x:0,y:0},rotation:0,type:a?B.DoubleDoor:B.Door}),l))}function r(){nt.update(a=>(a.push({position:{x:0,y:0},rotation:0,type:B.Window}),a))}function h(){nt.update(a=>(a.push({position:{x:0,y:0},rotation:0,type:B.Stairs}),a))}function b(){const a=document.createElement("input");a.type="file",a.style.display="none",a.click(),a.onchange=async l=>{const g=a.files.item(0),p=JSON.parse(await g.text());ut.set(p.rooms),nt.set(p.objects),a.remove()}}function k(){const l=JSON.stringify({rooms:_,objects:d}),g=new File([l],"floor-plan.json",{type:"application/json"}),p=URL.createObjectURL(g),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=p,i.download="floor-plan.json",i.click(),i.remove(),URL.revokeObjectURL(p)}return[c,v]}class br extends Ut{constructor(f){super(),Ht(this,f,_r,xr,Yt,{})}}function kr(S){let f,w,d,_,c;return w=new dr({}),_=new br({}),{c(){f=W("div"),$t(w.$$.fragment),d=ot(),$t(_.$$.fragment),this.h()},l(v){f=U(v,"DIV",{id:!0,class:!0});var o=Q(f);mt(w.$$.fragment,o),d=st(o),mt(_.$$.fragment,o),o.forEach(E),this.h()},h(){L(f,"id","container"),L(f,"class","svelte-18mbrbh")},m(v,o){Z(v,f,o),te(w,f,null),J(f,d),te(_,f,null),c=!0},p:Je,i(v){c||(m(w.$$.fragment,v),m(_.$$.fragment,v),c=!0)},o(v){at(w.$$.fragment,v),at(_.$$.fragment,v),c=!1},d(v){v&&E(f),ee(w),ee(_)}}}class Pr extends Ut{constructor(f){super(),Ht(this,f,null,kr,Yt,{})}}export{Pr as component};
