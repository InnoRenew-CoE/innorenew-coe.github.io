var Ye=Object.defineProperty;var We=(S,f,p)=>f in S?Ye(S,f,{enumerable:!0,configurable:!0,writable:!0,value:p}):S[f]=p;var N=(S,f,p)=>(We(S,typeof f!="symbol"?f+"":f,p),p);import{h as Ue,s as Yt,f as Wt,r as Te,b as K,o as He,y as Kt,z as $,e as Qt,n as Je}from"../chunks/scheduler.3azYSKjP.js";import{S as Ut,i as Ht,e as W,s as ot,m as Zt,c as U,d as Q,g as E,h as st,o as L,j as Z,y as H,t as m,q as ze,a as at,n as Ne,p as it,k as J,z as Fe,A as Ee,B as Gt,C as Ve,u as $t,v as mt,w as te,x as ee}from"../chunks/index.-TIuWNLo.js";import{w as ft}from"../chunks/index.km8bIHBx.js";function re(S){return(S==null?void 0:S.length)!==void 0?S:Array.from(S)}function gt(S,{delay:f=0,duration:p=400,easing:w=Ue}={}){const _=+getComputedStyle(S).opacity;return{delay:f,duration:p,easing:w,css:c=>`opacity: ${c*_}`}}const ut=ft([]),nt=ft([]),yt=ft("None"),lt=ft(),ct=ft(),vt=ft([]);var tt=(S=>(S.Drawing="Drawing",S.None="None",S))(tt||{}),rt=(S=>(S[S.Left=0]="Left",S[S.Right=1]="Right",S[S.Center=2]="Center",S[S.Top=3]="Top",S[S.Bottom=4]="Bottom",S))(rt||{}),B=(S=>(S.Door="Door",S.DoubleDoor="DoubleDoor",S.Desk="Desk",S.ParkingSpace="ParkingSpace",S.Stairs="Stairs",S.Window="Window",S.Room="Room",S))(B||{});function Ke(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}function Le(S){throw new Error('Could not dynamically require "'+S+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var je={exports:{}},xt={exports:{}},ne;function Qe(){return ne||(ne=1,function(S){(function f(p,w,_){var c=function(n){return Object.prototype.toString.call(n)==="[object Array]"};function v(n,r){if(!(this instanceof v))return new v(n,r);c(n)?(r=n[1],n=n[0]):typeof n=="object"&&n&&(r=n.y,n=n.x),this.x=v.clean(n||0),this.y=v.clean(r||0)}v.prototype={change:function(n){if(typeof n=="function")this.observers?this.observers.push(n):this.observers=[n];else if(this.observers&&this.observers.length)for(var r=this.observers.length-1;r>=0;r--)this.observers[r](this,n);return this},ignore:function(n){if(this.observers)if(!n)this.observers=[];else for(var r=this.observers,h=r.length;h--;)r[h]===n&&r.splice(h,1);return this},set:function(n,r,h){if(typeof n!="number"&&(h=r,r=n.y,n=n.x),this.x===n&&this.y===r)return this;var b=null;if(h!==!1&&this.observers&&this.observers.length&&(b=this.clone()),this.x=v.clean(n),this.y=v.clean(r),h!==!1)return this.change(b)},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(n){return n?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(n,r,h){return typeof n!="number"&&(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),n+=this.x,r+=this.y,h?new this.constructor(n,r):this.set(n,r)},subtract:function(n,r,h){return typeof n!="number"&&(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),n=this.x-n,r=this.y-r,h?new this.constructor(n,r):this.set(n,r)},multiply:function(n,r,h){return typeof n!="number"?(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)):typeof r!="number"&&(h=r,r=n),n*=this.x,r*=this.y,h?new this.constructor(n,r):this.set(n,r)},rotate:function(n,r,h){var b=this.x,k=this.y,a=Math.cos(n),l=Math.sin(n),g,x;return r=r?-1:1,g=a*b-r*l*k,x=r*l*b+a*k,h?new this.constructor(g,x):this.set(g,x)},length:function(){var n=this.x,r=this.y;return Math.sqrt(n*n+r*r)},lengthSquared:function(){var n=this.x,r=this.y;return n*n+r*r},distance:function(n){var r=this.x-n.x,h=this.y-n.y;return Math.sqrt(r*r+h*h)},nearest:function(n){for(var r=Number.MAX_VALUE,h=null,b,k=n.length-1;k>=0;k--)b=this.distance(n[k]),b<=r&&(r=b,h=n[k]);return h},normalize:function(n){var r=this.length(),h=r<Number.MIN_VALUE?0:1/r;return n?new this.constructor(this.x*h,this.y*h):this.set(this.x*h,this.y*h)},equal:function(n,r){return typeof n!="number"&&(c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)),v.clean(n)===this.x&&v.clean(r)===this.y},abs:function(n){var r=Math.abs(this.x),h=Math.abs(this.y);return n?new this.constructor(r,h):this.set(r,h)},min:function(n,r){var h=this.x,b=this.y,k=n.x,a=n.y,l=h<k?h:k,g=b<a?b:a;return r?new this.constructor(l,g):this.set(l,g)},max:function(n,r){var h=this.x,b=this.y,k=n.x,a=n.y,l=h>k?h:k,g=b>a?b:a;return r?new this.constructor(l,g):this.set(l,g)},clamp:function(n,r,h){var b=this.min(r,!0).max(n);return h?b:this.set(b.x,b.y)},lerp:function(n,r,h){return this.add(n.subtract(this,!0).multiply(r),h)},skew:function(n){return n?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(n){return v.clean(this.x*n.x+n.y*this.y)},perpDot:function(n){return v.clean(this.x*n.y-this.y*n.x)},angleTo:function(n){return Math.atan2(this.perpDot(n),this.dot(n))},divide:function(n,r,h){if(typeof n!="number"?(h=r,c(n)?(r=n[1],n=n[0]):(r=n.y,n=n.x)):typeof r!="number"&&(h=r,r=n),n===0||r===0)throw new Error("division by zero");if(isNaN(n)||isNaN(r))throw new Error("NaN detected");return h?new this.constructor(this.x/n,this.y/r):this.set(this.x/n,this.y/r)},isPointOnLine:function(n,r){return(n.y-this.y)*(n.x-r.x)===(n.y-r.y)*(n.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(n){return this.set(n[0],n[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:v},v.fromArray=function(n,r){return new(r||v)(n[0],n[1])},v.precision=w||8;var o=Math.pow(10,v.precision);return v.clean=p||function(n){if(isNaN(n))throw new Error("NaN detected");if(!isFinite(n))throw new Error("Infinity detected");return Math.round(n)===n?n:Math.round(n*o)/o},v.inject=f,p||(v.fast=f(function(n){return n}),S.exports=v),v})()}(xt)),xt.exports}var dt={exports:{}},ie;function Jt(){return ie||(ie=1,function(S){function f(p,w,_,c,v,o,n,r){if(arguments.length===4){var h=p,b=w,k=_,a=c;h.length&&h.length===2?(p=h[0],w=h[1],_=b[0],c=b[1],v=k[0],o=k[1],n=a[0],r=a[1]):(p=h.x,w=h.y,_=b.x,c=b.y,v=k.x,o=k.y,n=a.x,r=a.y)}var l,g,x,i,s,t,e,u,M,R,d,q,D;if(l=c-w,x=p-_,s=_*w-p*c,M=l*v+x*o+s,R=l*n+x*r+s,!(M!==0&&R!==0&&(M>=0&&R>=0||M<0&&R<0))&&(g=r-o,i=v-n,t=n*o-v*r,e=g*p+i*w+t,u=g*_+i*c+t,!(e!==0&&u!==0&&(e>=0&&u>=0||e<0&&u<0))))return d=l*i-g*x,d===0?!0:(q=x*t-i*s,D=g*s-l*t,[(q<0,q/d),(D<0,D/d)])}S.exports&&(S.exports=f),typeof window<"u"&&(window.segseg=window.segseg||f)}(dt)),dt.exports}var _t={exports:{}},bt={exports:{}},oe;function Ze(){return oe||(oe=1,function(S){(function f(p,w,_){function c(o,n){if(!(this instanceof c))return new c(o,n);if(typeof o=="object"&&o){this.y=o.y||0,this.x=o.x||0;return}this.x=c.clean(o||0),this.y=c.clean(n||0)}c.prototype={change:function(o){if(o)this.observers?this.observers.push(o):this.observers=[o];else if(this.observers)for(var n=this.observers.length-1;n>=0;n--)this.observers[n](this);return this},ignore:function(o){if(this.observers)for(var n=this.observers,r=n.length;r--;)n[r]===o&&n.splice(r,1);return this},set:function(o,n,r){if(typeof o!="number"&&(r=n,n=o.y,o=o.x),this.x===o&&this.y===n)return this;if(this.x=c.clean(o),this.y=c.clean(n),r!==!1)return this.change()},zero:function(){return this.set(0,0)},clone:function(){return new c(this.x,this.y)},negate:function(o){return o?new c(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(o,n){return n?new c(this.x+o.x,this.y+o.y):(this.x+=o.x,this.y+=o.y,this.change())},subtract:function(o,n){return n?new c(this.x-o.x,this.y-o.y):(this.x-=o.x,this.y-=o.y,this.change())},multiply:function(o,n){var r,h;return typeof o!="number"?(r=o.x,h=o.y):r=h=o,n?new c(this.x*r,this.y*h):this.set(this.x*r,this.y*h)},rotate:function(o,n,r){var h=this.x,b=this.y,k=Math.cos(o),a=Math.sin(o),l,g;return n=n?-1:1,l=k*h-n*a*b,g=n*a*h+k*b,r?new c(l,g):this.set(l,g)},length:function(){var o=this.x,n=this.y;return Math.sqrt(o*o+n*n)},lengthSquared:function(){var o=this.x,n=this.y;return o*o+n*n},distance:function(o){var n=this.x-o.x,r=this.y-o.y;return Math.sqrt(n*n+r*r)},normalize:function(o){var n=this.length(),r=n<Number.MIN_VALUE?0:1/n;return o?new c(this.x*r,this.y*r):this.set(this.x*r,this.y*r)},equal:function(o,n){return n===_&&(n=o.y,o=o.x),c.clean(o)===this.x&&c.clean(n)===this.y},abs:function(o){var n=Math.abs(this.x),r=Math.abs(this.y);return o?new c(n,r):this.set(n,r)},min:function(o,n){var r=this.x,h=this.y,b=o.x,k=o.y,a=r<b?r:b,l=h<k?h:k;return n?new c(a,l):this.set(a,l)},max:function(o,n){var r=this.x,h=this.y,b=o.x,k=o.y,a=r>b?r:b,l=h>k?h:k;return n?new c(a,l):this.set(a,l)},clamp:function(o,n,r){var h=this.min(n,!0).max(o);return r?h:this.set(h.x,h.y)},lerp:function(o,n){return this.add(o.subtract(this,!0).multiply(n),!0)},skew:function(){return new c(-this.y,this.x)},dot:function(o){return c.clean(this.x*o.x+o.y*this.y)},perpDot:function(o){return c.clean(this.x*o.y-this.y*o.x)},angleTo:function(o){return Math.atan2(this.perpDot(o),this.dot(o))},divide:function(o,n){var r,h;if(typeof o!="number"?(r=o.x,h=o.y):r=h=o,r===0||h===0)throw new Error("division by zero");if(isNaN(r)||isNaN(h))throw new Error("NaN detected");return n?new c(this.x/r,this.y/h):this.set(this.x/r,this.y/h)},isPointOnLine:function(o,n){return(o.y-this.y)*(o.x-n.x)===(o.y-n.y)*(o.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(o){return this.set(o[0],o[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"}},c.fromArray=function(o){return new c(o[0],o[1])},c.precision=w||8;var v=Math.pow(10,c.precision);return c.clean=p||function(o){if(isNaN(o))throw new Error("NaN detected");if(!isFinite(o))throw new Error("Infinity detected");return Math.round(o)===o?o:Math.round(o*v)/v},c.inject=f,p||(c.fast=f(function(o){return o}),S.exports=c),c})()}(bt)),bt.exports}var se;function Ge(){return se||(se=1,function(S){if(typeof Le<"u")var f=Ze(),p=Jt();var w=function(r){return Object.prototype.toString.call(r)==="[object Array]"},_=function(r){return typeof r<"u"},c=function(r,h){return _(r)?r:h},v=function(r){return r!==1/0&&r!==-1/0},o=function(r,h,b,k){return r*k-h*b};function n(r,h,b,k){if(this._listeners=[],!(this instanceof n))return new n(r,h,b,k);if(_(b)&&_(k))return n.fromPoints(r,h,b,k);_(r)&&this.slope(r),_(h)&&this.yintercept(h)}n.prototype._yintercept=null,n.prototype._xintercept=null,n.prototype._slope=null,n.prototype.change=function(r){if(typeof r=="function")return this._listeners.push(r),r},n.prototype.ignore=function(r){r?this._listeners=this._listeners.filter(function(h){return h!==r}):this._listeners=[]},n.prototype.notify=function(r){for(var h=this._listeners,b=h.length,k=0;k<b;k++)h[k](this)},n.prototype.yintercept=function(r){return _(r)&&(v(r)&&(r=f.clean(r)),this._yintercept!==r&&(this._yintercept=r,this.isHorizontal()||(this._xintercept=this.solveForX(0)),this.notify())),c(this._yintercept,null)},n.prototype.xintercept=function(r){if(_(r)&&(v(r)&&(r=f.clean(r)),this._xintercept!==r)){if(!this.isVertical()){var h=this._xintercept-r;this._yintercept-=h*-this._slope}this._xintercept=r,this.notify()}return c(this._xintercept,null)},n.prototype.slope=function(r){if(_(r)&&(v(r)&&(r=f.clean(r)),this._slope!==r)){var h=this._slope;if(this._slope=r,h!==null){var b=this.solveForX(0);v(b)||(b=null),this._xintercept=b}this.notify()}return c(this._slope,null)},n.prototype.intersectSegment=function(r,h,b,k){var a=b-r,l=k-h,g,x,i,s,t=this.isHorizontal(),e=this.isVertical();if(a===0){if(e)return r===this.xintercept()}else if(l===0){if(t)return h===this.yintercept()}else if(l/a===this.slope())return h===this.solveForY(r);r>b?(g=b-10,i=r+10):(g=r-10,i=b+10);var u;if(this.isHorizontal())y=this.yintercept(),u=p(g,y,i,y,r,h,b,k);else if(this.isVertical()){h>k?(x=k-10,s=h+10):(x=h-10,s=k+10);var M=this.xintercept();u=p(M,x,M,s,r,h,b,k)}else x=this.solveForY(g),s=this.solveForY(i),u=p(g,x,i,s,r,h,b,k);return u&&u!==!0?f.fromArray(u):u},n.prototype.createPerpendicular=function(r){if(this.isVertical())return new n(0,r.y);if(this.isHorizontal()){var h=new n;return h.xintercept(r.x),h.slope(1/0),h}else{var b=-1/this.slope();return new n(b,r.y-b*r.x)}},n.prototype.intersectCircle=function(r,h){var b=h*h,k=this.slope(),a=this.yintercept(),l,g,x,i;this.isHorizontal()?(l=1,g=0):this.isVertical()?(k=h,a=b,l=0,g=k):(l=1/k,g=1);var s=this.isVertical()?this.xintercept():1,t=a+k,e=l*l,u=g*g,M=l*(r.y-t)-g*(r.x-s);M*=M;var R=e+u,d=Math.sqrt(b*(e+u)-M);if(isNaN(d))return[];d/=R;var q=l*(r.x-s)+g*(r.y-t),D=q/R+d,P=q/R-d;x=new f(s+D*l,t+D*g),i=new f(s+P*l,t+P*g);var I=[x];return x.equal(i)||I.push(i),I},n.prototype.solveForX=function(r){return this.isVertical()?this.xintercept():(r-this.yintercept())/this.slope()},n.prototype.solveForY=function(r){return this.isHorizontal()?this.yintercept():this.slope()*r+this.yintercept()},n.prototype.intersect=function(r,h,b,k){if(_(h)&&_(k)||_(r.end))return this.intersectSegment(r,h,b,k);var a=this.slope(),l=r.slope();if(a===l)return this.yintercept()===r.yintercept()&&this.xintercept()===r.xintercept();if(v(a)&&v(l)){if(this.isHorizontal())return new f(r.solveForX(this.yintercept()),this.yintercept());if(r.isHorizontal())return new f(this.solveForX(r.yintercept()),r.yintercept());var g=r.solveForX(-1);h=r.solveForY(g),b=r.solveForX(1),k=r.solveForY(b);var x=this.solveForX(-1),i=this.solveForY(x),s=this.solveForX(1),t=this.solveForY(s),e=o(g,h,b,k),u=o(x,i,s,t),M=o(e,g-b,u,x-s),R=o(e,h-k,u,i-t),d=o(g-b,h-k,x-s,i-t);return f(M/d,R/d)}else{var q,D,P=this.xintercept()||r.xintercept();return v(a)?(q=a,D=this.yintercept()):(q=l,D=r.yintercept()),q!==0?f(P,P*q+D):f(P,D)}},n.fromPoints=function(r,h,b,k){w(h)?(k=h[1],b=h[0]):_(h)&&_(h.x)&&_(h.y)&&(k=h.y,b=h.x),w(r)?(h=r[1],r=r[0]):_(r)&&_(r.x)&&_(r.y)&&(h=r.y,r=r.x);var a=new n,l=(k-h)/(b-r);return a.slope(l),a.isHorizontal()?a.yintercept(h):a.isVertical()?a.xintercept(b):a.yintercept(h-l*r),a},n.prototype.isHorizontal=function(){return!this.slope()},n.prototype.isVertical=function(){return!v(this.slope())},n.prototype.closestPointTo=function(r){var h=this.yintercept(),b=this.xintercept();return this.slope(),this.isHorizontal()?f(r.x,h):this.isVertical()?f(b,r.y):this.intersect(this.createPerpendicular(r))},n.prototype.containsPoint=function(r,h){var b=r;return _(h)||(h=r.y,b=r.x),this.isHorizontal()?h===this.yintercept():this.isVertical()?b===this.xintercept():h===this.solveForY(b)},S.exports=n,typeof window<"u"&&(window.Line2=window.Line2||n)}(_t)),_t.exports}var kt={exports:{}},St,ae;function Vt(){if(ae)return St;ae=1,St=f;var S=+(Math.pow(2,27)+1);function f(p,w,_){var c=p*w,v=S*p,o=v-p,n=v-o,r=p-n,h=S*w,b=h-w,k=h-b,a=w-k,l=c-n*k,g=l-r*k,x=g-n*a,i=r*a-x;return _?(_[0]=i,_[1]=c,_):[i,c]}return St}var qt,fe;function Ce(){if(fe)return qt;fe=1,qt=f;function S(p,w){var _=p+w,c=_-p,v=_-c,o=w-c,n=p-v,r=n+o;return r?[r,_]:[_]}function f(p,w){var _=p.length|0,c=w.length|0;if(_===1&&c===1)return S(p[0],w[0]);var v=_+c,o=new Array(v),n=0,r=0,h=0,b=Math.abs,k=p[r],a=b(k),l=w[h],g=b(l),x,i;a<g?(i=k,r+=1,r<_&&(k=p[r],a=b(k))):(i=l,h+=1,h<c&&(l=w[h],g=b(l))),r<_&&a<g||h>=c?(x=k,r+=1,r<_&&(k=p[r],a=b(k))):(x=l,h+=1,h<c&&(l=w[h],g=b(l)));for(var s=x+i,t=s-x,e=i-t,u=e,M=s,R,d,q,D,P;r<_&&h<c;)a<g?(x=k,r+=1,r<_&&(k=p[r],a=b(k))):(x=l,h+=1,h<c&&(l=w[h],g=b(l))),i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R;for(;r<_;)x=k,i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R,r+=1,r<_&&(k=p[r]);for(;h<c;)x=l,i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R,h+=1,h<c&&(l=w[h]);return u&&(o[n++]=u),M&&(o[n++]=M),n||(o[n++]=0),o.length=n,o}return qt}var Dt,ue;function $e(){if(ue)return Dt;ue=1,Dt=S;function S(f,p,w){var _=f+p,c=_-f,v=_-c,o=p-c,n=f-v;return w?(w[0]=n+o,w[1]=_,w):[n+o,_]}return Dt}var Mt,he;function Be(){if(he)return Mt;he=1;var S=Vt(),f=$e();Mt=p;function p(w,_){var c=w.length;if(c===1){var v=S(w[0],_);return v[0]?v:[v[1]]}var o=new Array(2*c),n=[.1,.1],r=[.1,.1],h=0;S(w[0],_,n),n[0]&&(o[h++]=n[0]);for(var b=1;b<c;++b){S(w[b],_,r);var k=n[1];f(k,r[0],n),n[0]&&(o[h++]=n[0]);var a=r[1],l=n[1],g=a+l,x=g-a,i=l-x;n[1]=g,i&&(o[h++]=i)}return n[1]&&(o[h++]=n[1]),h===0&&(o[h++]=0),o.length=h,o}return Mt}var Pt,le;function me(){if(le)return Pt;le=1,Pt=f;function S(p,w){var _=p+w,c=_-p,v=_-c,o=w-c,n=p-v,r=n+o;return r?[r,_]:[_]}function f(p,w){var _=p.length|0,c=w.length|0;if(_===1&&c===1)return S(p[0],-w[0]);var v=_+c,o=new Array(v),n=0,r=0,h=0,b=Math.abs,k=p[r],a=b(k),l=-w[h],g=b(l),x,i;a<g?(i=k,r+=1,r<_&&(k=p[r],a=b(k))):(i=l,h+=1,h<c&&(l=-w[h],g=b(l))),r<_&&a<g||h>=c?(x=k,r+=1,r<_&&(k=p[r],a=b(k))):(x=l,h+=1,h<c&&(l=-w[h],g=b(l)));for(var s=x+i,t=s-x,e=i-t,u=e,M=s,R,d,q,D,P;r<_&&h<c;)a<g?(x=k,r+=1,r<_&&(k=p[r],a=b(k))):(x=l,h+=1,h<c&&(l=-w[h],g=b(l))),i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R;for(;r<_;)x=k,i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R,r+=1,r<_&&(k=p[r]);for(;h<c;)x=l,i=u,s=x+i,t=s-x,e=i-t,e&&(o[n++]=e),R=M+s,d=R-M,q=R-d,D=s-d,P=M-q,u=P+D,M=R,h+=1,h<c&&(l=-w[h]);return u&&(o[n++]=u),M&&(o[n++]=M),n||(o[n++]=0),o.length=n,o}return Pt}var ce;function pt(){return ce||(ce=1,function(S){var f=Vt(),p=Ce(),w=Be(),_=me(),c=5,v=11102230246251565e-32,o=(3+16*v)*v,n=(7+56*v)*v;function r(t,e,u,M){return function(d,q,D){var P=t(t(e(q[1],D[0]),e(-D[1],q[0])),t(e(d[1],q[0]),e(-q[1],d[0]))),I=t(e(d[1],D[0]),e(-D[1],d[0])),A=M(P,I);return A[A.length-1]}}function h(t,e,u,M){return function(d,q,D,P){var I=t(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),q[2]),t(u(t(e(q[1],P[0]),e(-P[1],q[0])),-D[2]),u(t(e(q[1],D[0]),e(-D[1],q[0])),P[2]))),t(u(t(e(q[1],P[0]),e(-P[1],q[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),P[2])))),A=t(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-D[2]),u(t(e(d[1],D[0]),e(-D[1],d[0])),P[2]))),t(u(t(e(q[1],D[0]),e(-D[1],q[0])),d[2]),t(u(t(e(d[1],D[0]),e(-D[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),D[2])))),z=M(I,A);return z[z.length-1]}}function b(t,e,u,M){return function(d,q,D,P,I){var A=t(t(t(u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),D[2]),t(u(t(e(D[1],I[0]),e(-I[1],D[0])),-P[2]),u(t(e(D[1],P[0]),e(-P[1],D[0])),I[2]))),q[3]),t(u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),q[2]),t(u(t(e(q[1],I[0]),e(-I[1],q[0])),-P[2]),u(t(e(q[1],P[0]),e(-P[1],q[0])),I[2]))),-D[3]),u(t(u(t(e(D[1],I[0]),e(-I[1],D[0])),q[2]),t(u(t(e(q[1],I[0]),e(-I[1],q[0])),-D[2]),u(t(e(q[1],D[0]),e(-D[1],q[0])),I[2]))),P[3]))),t(u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),q[2]),t(u(t(e(q[1],P[0]),e(-P[1],q[0])),-D[2]),u(t(e(q[1],D[0]),e(-D[1],q[0])),P[2]))),-I[3]),t(u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),q[2]),t(u(t(e(q[1],I[0]),e(-I[1],q[0])),-P[2]),u(t(e(q[1],P[0]),e(-P[1],q[0])),I[2]))),d[3]),u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-P[2]),u(t(e(d[1],P[0]),e(-P[1],d[0])),I[2]))),-q[3])))),t(t(u(t(u(t(e(q[1],I[0]),e(-I[1],q[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),I[2]))),P[3]),t(u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),P[2]))),-I[3]),u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),q[2]),t(u(t(e(q[1],P[0]),e(-P[1],q[0])),-D[2]),u(t(e(q[1],D[0]),e(-D[1],q[0])),P[2]))),d[3]))),t(u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-D[2]),u(t(e(d[1],D[0]),e(-D[1],d[0])),P[2]))),-q[3]),t(u(t(u(t(e(q[1],P[0]),e(-P[1],q[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),P[2]))),D[3]),u(t(u(t(e(q[1],D[0]),e(-D[1],q[0])),d[2]),t(u(t(e(d[1],D[0]),e(-D[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),D[2]))),-P[3]))))),z=t(t(t(u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),D[2]),t(u(t(e(D[1],I[0]),e(-I[1],D[0])),-P[2]),u(t(e(D[1],P[0]),e(-P[1],D[0])),I[2]))),d[3]),u(t(u(t(e(P[1],I[0]),e(-I[1],P[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-P[2]),u(t(e(d[1],P[0]),e(-P[1],d[0])),I[2]))),-D[3])),t(u(t(u(t(e(D[1],I[0]),e(-I[1],D[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-D[2]),u(t(e(d[1],D[0]),e(-D[1],d[0])),I[2]))),P[3]),u(t(u(t(e(D[1],P[0]),e(-P[1],D[0])),d[2]),t(u(t(e(d[1],P[0]),e(-P[1],d[0])),-D[2]),u(t(e(d[1],D[0]),e(-D[1],d[0])),P[2]))),-I[3]))),t(t(u(t(u(t(e(D[1],I[0]),e(-I[1],D[0])),q[2]),t(u(t(e(q[1],I[0]),e(-I[1],q[0])),-D[2]),u(t(e(q[1],D[0]),e(-D[1],q[0])),I[2]))),d[3]),u(t(u(t(e(D[1],I[0]),e(-I[1],D[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-D[2]),u(t(e(d[1],D[0]),e(-D[1],d[0])),I[2]))),-q[3])),t(u(t(u(t(e(q[1],I[0]),e(-I[1],q[0])),d[2]),t(u(t(e(d[1],I[0]),e(-I[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),I[2]))),D[3]),u(t(u(t(e(q[1],D[0]),e(-D[1],q[0])),d[2]),t(u(t(e(d[1],D[0]),e(-D[1],d[0])),-q[2]),u(t(e(d[1],q[0]),e(-q[1],d[0])),D[2]))),-I[3])))),j=M(A,z);return j[j.length-1]}}function k(t){var e=t===3?r:t===4?h:b;return e(p,f,w,_)}var a=k(3),l=k(4),g=[function(){return 0},function(){return 0},function(e,u){return u[0]-e[0]},function(e,u,M){var R=(e[1]-M[1])*(u[0]-M[0]),d=(e[0]-M[0])*(u[1]-M[1]),q=R-d,D;if(R>0){if(d<=0)return q;D=R+d}else if(R<0){if(d>=0)return q;D=-(R+d)}else return q;var P=o*D;return q>=P||q<=-P?q:a(e,u,M)},function(e,u,M,R){var d=e[0]-R[0],q=u[0]-R[0],D=M[0]-R[0],P=e[1]-R[1],I=u[1]-R[1],A=M[1]-R[1],z=e[2]-R[2],j=u[2]-R[2],et=M[2]-R[2],V=q*A,ht=D*I,O=D*P,T=d*A,F=d*I,X=q*P,Y=z*(V-ht)+j*(O-T)+et*(F-X),C=(Math.abs(V)+Math.abs(ht))*Math.abs(z)+(Math.abs(O)+Math.abs(T))*Math.abs(j)+(Math.abs(F)+Math.abs(X))*Math.abs(et),G=n*C;return Y>G||-Y>G?Y:l(e,u,M,R)}];function x(t){var e=g[t.length];return e||(e=g[t.length]=k(t.length)),e.apply(void 0,t)}function i(t,e,u,M,R,d,q){return function(P,I,A,z,j){switch(arguments.length){case 0:case 1:return 0;case 2:return M(P,I);case 3:return R(P,I,A);case 4:return d(P,I,A,z);case 5:return q(P,I,A,z,j)}for(var et=new Array(arguments.length),V=0;V<arguments.length;++V)et[V]=arguments[V];return t(et)}}function s(){for(;g.length<=c;)g.push(k(g.length));S.exports=i.apply(void 0,[x].concat(g));for(var t=0;t<=c;++t)S.exports[t]=g[t]}s()}(kt)),kt.exports}var Rt,ve;function tr(){if(ve)return Rt;ve=1;function S(v,o,n,r,h){for(var b=h+1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l>=0?(b=k,h=k-1):r=k+1}return b}function f(v,o,n,r,h){for(var b=h+1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l>0?(b=k,h=k-1):r=k+1}return b}function p(v,o,n,r,h){for(var b=r-1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l<0?(b=k,r=k+1):h=k-1}return b}function w(v,o,n,r,h){for(var b=r-1;r<=h;){var k=r+h>>>1,a=v[k],l=n!==void 0?n(a,o):a-o;l<=0?(b=k,r=k+1):h=k-1}return b}function _(v,o,n,r,h){for(;r<=h;){var b=r+h>>>1,k=v[b],a=n!==void 0?n(k,o):k-o;if(a===0)return b;a<=0?r=b+1:h=b-1}return-1}function c(v,o,n,r,h,b){return typeof n=="function"?b(v,o,n,r===void 0?0:r|0,h===void 0?v.length-1:h|0):b(v,o,void 0,n===void 0?0:n|0,r===void 0?v.length-1:r|0)}return Rt={ge:function(v,o,n,r,h){return c(v,o,n,r,h,S)},gt:function(v,o,n,r,h){return c(v,o,n,r,h,f)},lt:function(v,o,n,r,h){return c(v,o,n,r,h,p)},le:function(v,o,n,r,h){return c(v,o,n,r,h,w)},eq:function(v,o,n,r,h){return c(v,o,n,r,h,_)}},Rt}var It,ge;function er(){if(ge)return It;ge=1,It=x;var S=0,f=1;function p(i,s,t,e,u,M){this._color=i,this.key=s,this.value=t,this.left=e,this.right=u,this._count=M}function w(i){return new p(i._color,i.key,i.value,i.left,i.right,i._count)}function _(i,s){return new p(i,s.key,s.value,s.left,s.right,s._count)}function c(i){i._count=1+(i.left?i.left._count:0)+(i.right?i.right._count:0)}function v(i,s){this._compare=i,this.root=s}var o=v.prototype;Object.defineProperty(o,"keys",{get:function(){var i=[];return this.forEach(function(s,t){i.push(s)}),i}}),Object.defineProperty(o,"values",{get:function(){var i=[];return this.forEach(function(s,t){i.push(t)}),i}}),Object.defineProperty(o,"length",{get:function(){return this.root?this.root._count:0}}),o.insert=function(i,s){for(var t=this._compare,e=this.root,u=[],M=[];e;){var R=t(i,e.key);u.push(e),M.push(R),R<=0?e=e.left:e=e.right}u.push(new p(S,i,s,null,null,1));for(var d=u.length-2;d>=0;--d){var e=u[d];M[d]<=0?u[d]=new p(e._color,e.key,e.value,u[d+1],e.right,e._count+1):u[d]=new p(e._color,e.key,e.value,e.left,u[d+1],e._count+1)}for(var d=u.length-1;d>1;--d){var q=u[d-1],e=u[d];if(q._color===f||e._color===f)break;var D=u[d-2];if(D.left===q)if(q.left===e){var P=D.right;if(P&&P._color===S)q._color=f,D.right=_(f,P),D._color=S,d-=1;else{if(D._color=S,D.left=q.right,q._color=f,q.right=D,u[d-2]=q,u[d-1]=e,c(D),c(q),d>=3){var I=u[d-3];I.left===D?I.left=q:I.right=q}break}}else{var P=D.right;if(P&&P._color===S)q._color=f,D.right=_(f,P),D._color=S,d-=1;else{if(q.right=e.left,D._color=S,D.left=e.right,e._color=f,e.left=q,e.right=D,u[d-2]=e,u[d-1]=q,c(D),c(q),c(e),d>=3){var I=u[d-3];I.left===D?I.left=e:I.right=e}break}}else if(q.right===e){var P=D.left;if(P&&P._color===S)q._color=f,D.left=_(f,P),D._color=S,d-=1;else{if(D._color=S,D.right=q.left,q._color=f,q.left=D,u[d-2]=q,u[d-1]=e,c(D),c(q),d>=3){var I=u[d-3];I.right===D?I.right=q:I.left=q}break}}else{var P=D.left;if(P&&P._color===S)q._color=f,D.left=_(f,P),D._color=S,d-=1;else{if(q.left=e.right,D._color=S,D.right=e.left,e._color=f,e.right=q,e.left=D,u[d-2]=e,u[d-1]=q,c(D),c(q),c(e),d>=3){var I=u[d-3];I.right===D?I.right=e:I.left=e}break}}}return u[0]._color=f,new v(t,u[0])};function n(i,s){if(s.left){var t=n(i,s.left);if(t)return t}var t=i(s.key,s.value);if(t)return t;if(s.right)return n(i,s.right)}function r(i,s,t,e){var u=s(i,e.key);if(u<=0){if(e.left){var M=r(i,s,t,e.left);if(M)return M}var M=t(e.key,e.value);if(M)return M}if(e.right)return r(i,s,t,e.right)}function h(i,s,t,e,u){var M=t(i,u.key),R=t(s,u.key),d;if(M<=0&&(u.left&&(d=h(i,s,t,e,u.left),d)||R>0&&(d=e(u.key,u.value),d)))return d;if(R>0&&u.right)return h(i,s,t,e,u.right)}o.forEach=function(s,t,e){if(this.root)switch(arguments.length){case 1:return n(s,this.root);case 2:return r(t,this._compare,s,this.root);case 3:return this._compare(t,e)>=0?void 0:h(t,e,this._compare,s,this.root)}},Object.defineProperty(o,"begin",{get:function(){for(var i=[],s=this.root;s;)i.push(s),s=s.left;return new b(this,i)}}),Object.defineProperty(o,"end",{get:function(){for(var i=[],s=this.root;s;)i.push(s),s=s.right;return new b(this,i)}}),o.at=function(i){if(i<0)return new b(this,[]);for(var s=this.root,t=[];;){if(t.push(s),s.left){if(i<s.left._count){s=s.left;continue}i-=s.left._count}if(!i)return new b(this,t);if(i-=1,s.right){if(i>=s.right._count)break;s=s.right}else break}return new b(this,[])},o.ge=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M<=0&&(u=e.length),M<=0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.gt=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M<0&&(u=e.length),M<0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.lt=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M>0&&(u=e.length),M<=0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.le=function(i){for(var s=this._compare,t=this.root,e=[],u=0;t;){var M=s(i,t.key);e.push(t),M>=0&&(u=e.length),M<0?t=t.left:t=t.right}return e.length=u,new b(this,e)},o.find=function(i){for(var s=this._compare,t=this.root,e=[];t;){var u=s(i,t.key);if(e.push(t),u===0)return new b(this,e);u<=0?t=t.left:t=t.right}return new b(this,[])},o.remove=function(i){var s=this.find(i);return s?s.remove():this},o.get=function(i){for(var s=this._compare,t=this.root;t;){var e=s(i,t.key);if(e===0)return t.value;e<=0?t=t.left:t=t.right}};function b(i,s){this.tree=i,this._stack=s}var k=b.prototype;Object.defineProperty(k,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(k,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),k.clone=function(){return new b(this.tree,this._stack.slice())};function a(i,s){i.key=s.key,i.value=s.value,i.left=s.left,i.right=s.right,i._color=s._color,i._count=s._count}function l(i){for(var s,t,e,u,M=i.length-1;M>=0;--M){if(s=i[M],M===0){s._color=f;return}if(t=i[M-1],t.left===s){if(e=t.right,e.right&&e.right._color===S){if(e=t.right=w(e),u=e.right=w(e.right),t.right=e.left,e.left=t,e.right=u,e._color=t._color,s._color=f,t._color=f,u._color=f,c(t),c(e),M>1){var R=i[M-2];R.left===t?R.left=e:R.right=e}i[M-1]=e;return}else if(e.left&&e.left._color===S){if(e=t.right=w(e),u=e.left=w(e.left),t.right=u.left,e.left=u.right,u.left=t,u.right=e,u._color=t._color,t._color=f,e._color=f,s._color=f,c(t),c(e),c(u),M>1){var R=i[M-2];R.left===t?R.left=u:R.right=u}i[M-1]=u;return}if(e._color===f)if(t._color===S){t._color=f,t.right=_(S,e);return}else{t.right=_(S,e);continue}else{if(e=w(e),t.right=e.left,e.left=t,e._color=t._color,t._color=S,c(t),c(e),M>1){var R=i[M-2];R.left===t?R.left=e:R.right=e}i[M-1]=e,i[M]=t,M+1<i.length?i[M+1]=s:i.push(s),M=M+2}}else{if(e=t.left,e.left&&e.left._color===S){if(e=t.left=w(e),u=e.left=w(e.left),t.left=e.right,e.right=t,e.left=u,e._color=t._color,s._color=f,t._color=f,u._color=f,c(t),c(e),M>1){var R=i[M-2];R.right===t?R.right=e:R.left=e}i[M-1]=e;return}else if(e.right&&e.right._color===S){if(e=t.left=w(e),u=e.right=w(e.right),t.left=u.right,e.right=u.left,u.right=t,u.left=e,u._color=t._color,t._color=f,e._color=f,s._color=f,c(t),c(e),c(u),M>1){var R=i[M-2];R.right===t?R.right=u:R.left=u}i[M-1]=u;return}if(e._color===f)if(t._color===S){t._color=f,t.left=_(S,e);return}else{t.left=_(S,e);continue}else{if(e=w(e),t.left=e.right,e.right=t,e._color=t._color,t._color=S,c(t),c(e),M>1){var R=i[M-2];R.right===t?R.right=e:R.left=e}i[M-1]=e,i[M]=t,M+1<i.length?i[M+1]=s:i.push(s),M=M+2}}}}k.remove=function(){var i=this._stack;if(i.length===0)return this.tree;var s=new Array(i.length),t=i[i.length-1];s[s.length-1]=new p(t._color,t.key,t.value,t.left,t.right,t._count);for(var e=i.length-2;e>=0;--e){var t=i[e];t.left===i[e+1]?s[e]=new p(t._color,t.key,t.value,s[e+1],t.right,t._count):s[e]=new p(t._color,t.key,t.value,t.left,s[e+1],t._count)}if(t=s[s.length-1],t.left&&t.right){var u=s.length;for(t=t.left;t.right;)s.push(t),t=t.right;var M=s[u-1];s.push(new p(t._color,M.key,M.value,t.left,t.right,t._count)),s[u-1].key=t.key,s[u-1].value=t.value;for(var e=s.length-2;e>=u;--e)t=s[e],s[e]=new p(t._color,t.key,t.value,t.left,s[e+1],t._count);s[u-1].left=s[u]}if(t=s[s.length-1],t._color===S){var R=s[s.length-2];R.left===t?R.left=null:R.right===t&&(R.right=null),s.pop();for(var e=0;e<s.length;++e)s[e]._count--;return new v(this.tree._compare,s[0])}else if(t.left||t.right){t.left?a(t,t.left):t.right&&a(t,t.right),t._color=f;for(var e=0;e<s.length-1;++e)s[e]._count--;return new v(this.tree._compare,s[0])}else{if(s.length===1)return new v(this.tree._compare,null);for(var e=0;e<s.length;++e)s[e]._count--;var d=s[s.length-2];l(s),d.left===t?d.left=null:d.right=null}return new v(this.tree._compare,s[0])},Object.defineProperty(k,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(k,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(k,"index",{get:function(){var i=0,s=this._stack;if(s.length===0){var t=this.tree.root;return t?t._count:0}else s[s.length-1].left&&(i=s[s.length-1].left._count);for(var e=s.length-2;e>=0;--e)s[e+1]===s[e].right&&(++i,s[e].left&&(i+=s[e].left._count));return i},enumerable:!0}),k.next=function(){var i=this._stack;if(i.length!==0){var s=i[i.length-1];if(s.right)for(s=s.right;s;)i.push(s),s=s.left;else for(i.pop();i.length>0&&i[i.length-1].right===s;)s=i[i.length-1],i.pop()}},Object.defineProperty(k,"hasNext",{get:function(){var i=this._stack;if(i.length===0)return!1;if(i[i.length-1].right)return!0;for(var s=i.length-1;s>0;--s)if(i[s-1].left===i[s])return!0;return!1}}),k.update=function(i){var s=this._stack;if(s.length===0)throw new Error("Can't update empty node!");var t=new Array(s.length),e=s[s.length-1];t[t.length-1]=new p(e._color,e.key,i,e.left,e.right,e._count);for(var u=s.length-2;u>=0;--u)e=s[u],e.left===s[u+1]?t[u]=new p(e._color,e.key,e.value,t[u+1],e.right,e._count):t[u]=new p(e._color,e.key,e.value,e.left,t[u+1],e._count);return new v(this.tree._compare,t[0])},k.prev=function(){var i=this._stack;if(i.length!==0){var s=i[i.length-1];if(s.left)for(s=s.left;s;)i.push(s),s=s.right;else for(i.pop();i.length>0&&i[i.length-1].left===s;)s=i[i.length-1],i.pop()}},Object.defineProperty(k,"hasPrev",{get:function(){var i=this._stack;if(i.length===0)return!1;if(i[i.length-1].left)return!0;for(var s=i.length-1;s>0;--s)if(i[s-1].right===i[s])return!0;return!1}});function g(i,s){return i<s?-1:i>s?1:0}function x(i){return new v(i||g,null)}return It}var Ot,ye;function rr(){if(ye)return Ot;ye=1,Ot=p;var S=pt();function f(w,_){var c,v;if(_[0][0]<_[1][0])c=_[0],v=_[1];else if(_[0][0]>_[1][0])c=_[1],v=_[0];else{var o=Math.min(w[0][1],w[1][1]),n=Math.max(w[0][1],w[1][1]),r=Math.min(_[0][1],_[1][1]),h=Math.max(_[0][1],_[1][1]);return n<r?n-r:o>h?o-h:n-h}var b,k;w[0][1]<w[1][1]?(b=w[0],k=w[1]):(b=w[1],k=w[0]);var a=S(v,c,b);return a||(a=S(v,c,k),a)?a:k-v}function p(w,_){var c,v;if(_[0][0]<_[1][0])c=_[0],v=_[1];else if(_[0][0]>_[1][0])c=_[1],v=_[0];else return f(_,w);var o,n;if(w[0][0]<w[1][0])o=w[0],n=w[1];else if(w[0][0]>w[1][0])o=w[1],n=w[0];else return-f(w,_);var r=S(c,v,n),h=S(c,v,o);if(r<0){if(h<=0)return r}else if(r>0){if(h>=0)return r}else if(h)return h;if(r=S(n,o,v),h=S(n,o,c),r<0){if(h<=0)return r}else if(r>0){if(h>=0)return r}else if(h)return h;return v[0]-n[0]}return Ot}var At,pe;function nr(){if(pe)return At;pe=1,At=h;var S=tr(),f=er(),p=pt(),w=rr();function _(b,k,a){this.slabs=b,this.coordinates=k,this.horizontal=a}var c=_.prototype;function v(b,k){return b.y-k}function o(b,k){for(var a=null;b;){var l=b.key,g,x;l[0][0]<l[1][0]?(g=l[0],x=l[1]):(g=l[1],x=l[0]);var i=p(g,x,k);if(i<0)b=b.left;else if(i>0)if(k[0]!==l[1][0])a=b,b=b.right;else{var s=o(b.right,k);if(s)return s;b=b.left}else{if(k[0]!==l[1][0])return b;var s=o(b.right,k);if(s)return s;b=b.left}}return a}c.castUp=function(b){var k=S.le(this.coordinates,b[0]);if(k<0)return-1;this.slabs[k];var a=o(this.slabs[k],b),l=-1;if(a&&(l=a.value),this.coordinates[k]===b[0]){var g=null;if(a&&(g=a.key),k>0){var x=o(this.slabs[k-1],b);x&&(g?w(x.key,g)>0&&(g=x.key,l=x.value):(l=x.value,g=x.key))}var i=this.horizontal[k];if(i.length>0){var s=S.ge(i,b[1],v);if(s<i.length){var t=i[s];if(b[1]===t.y){if(t.closed)return t.index;for(;s<i.length-1&&i[s+1].y===b[1];)if(s=s+1,t=i[s],t.closed)return t.index;if(t.y===b[1]&&!t.start){if(s=s+1,s>=i.length)return l;t=i[s]}}if(t.start)if(g){var e=p(g[0],g[1],[b[0],t.y]);g[0][0]>g[1][0]&&(e=-e),e>0&&(l=t.index)}else l=t.index;else t.y!==b[1]&&(l=t.index)}}}return l};function n(b,k,a,l){this.y=b,this.index=k,this.start=a,this.closed=l}function r(b,k,a,l){this.x=b,this.segment=k,this.create=a,this.index=l}function h(b){for(var k=b.length,a=2*k,l=new Array(a),g=0;g<k;++g){var x=b[g],i=x[0][0]<x[1][0];l[2*g]=new r(x[0][0],x,i,g),l[2*g+1]=new r(x[1][0],x,!i,g)}l.sort(function(q,D){var P=q.x-D.x;return P||(P=q.create-D.create,P)?P:Math.min(q.segment[0][1],q.segment[1][1])-Math.min(D.segment[0][1],D.segment[1][1])});for(var s=f(w),t=[],e=[],u=[],g=0;g<a;){for(var M=l[g].x,R=[];g<a;){var d=l[g];if(d.x!==M)break;g+=1,d.segment[0][0]===d.x&&d.segment[1][0]===d.x?d.create&&(d.segment[0][1]<d.segment[1][1]?(R.push(new n(d.segment[0][1],d.index,!0,!0)),R.push(new n(d.segment[1][1],d.index,!1,!1))):(R.push(new n(d.segment[1][1],d.index,!0,!1)),R.push(new n(d.segment[0][1],d.index,!1,!0)))):d.create?s=s.insert(d.segment,d.index):s=s.remove(d.segment)}t.push(s.root),e.push(M),u.push(R)}return new _(t,e,u)}return At}var Tt,we;function ir(){if(we)return Tt;we=1,Tt=_;var S=pt(),f=nr();function p(c){return-1}function w(c,v,o,n){function r(h){var b=v.castUp(h);if(b<0)return o;var k=c[b];return n?S(h,k[1],k[0]):S(h,k[0],k[1])}return r}function _(c,v){v=!!v;for(var o=c.length,n=0,r=0;r<o;++r)n+=c[r].length;if(n===0)return p;for(var h=new Array(n),b=0,r=0;r<o;++r)for(var k=c[r],a=k.length,l=a-1,g=0;g<a;l=g++)h[b++]=[k[l],k[g]];var x=f(h),i,s=x.slabs[0];if(s){for(;s.left;)s=s.left;var t=s.key;t[0][0]<t[1][0]?i=-1:i=1}else{var t=h[x.horizontal[0][0].index];t[0][1]<t[1][1]?i=1:i=-1}return v&&(i=-i),w(h,x,i,v)}return Tt}var zt,xe;function or(){if(xe)return zt;xe=1,zt=p;var S=[0,0],f=[0,0];function p(w){for(var _=0,c=w[0],v=w.length,o=2;o<v;o++){var n=w[o-1],r=w[o];S[0]=c[0]-r[0],S[1]=c[1]-r[1],f[0]=c[0]-n[0],f[1]=c[1]-n[1],_+=S[0]*f[1]-S[1]*f[0]}return _/2}return zt}var Nt,de;function sr(){return de||(de=1,Nt=function(f){return f<0?-1:f>0?1:0}),Nt}var Ft,_e;function ar(){if(_e)return Ft;_e=1;var S=Jt(),f=ir(),p=or(),w=sr(),_=Math.abs;function c(l){for(var g=l.length,x=new Array(g),i=0;i<g;i++)x[i]=l[i].slice();return x}function v(l,g,x){this.vec=l,this.alpha=g||0,this.intersect=!!x}v.prototype={vec:null,next:null,next:null,prev:null,nextPoly:null,neighbor:null,intersect:null,entry:null,visited:!1,alpha:0,nextNonIntersection:function(){for(var g=this;g&&g.intersect;)g=g.next;return g},last:function(){for(var g=this;g.next&&g.next!==this;)g=g.next;return g},createLoop:function(){var g=this.last();g.prev.next=this,this.prev=g.prev},firstNodeOfInterest:function(){var g=this;if(g)do g=g.next;while(g!==this&&(!g.intersect||g.intersect&&g.visited));return g},insertBetween:function(g,x){for(var i=g;i!==x&&i.alpha<this.alpha;)i=i.next;this.next=i,this.prev=i.prev,this.prev&&(this.prev.next=this),this.next.prev=this}};function o(l){for(var g=l.length,x,i,s=0;s<g;s++){var t=l[s];x?(i.next=new v(t),i.next.prev=i,i=i.next):i=x=new v(t)}return x}function n(l,g){var x=l[0]-g[0],i=l[1]-g[1];return Math.sqrt(x*x+i*i)}function r(l){for(var g=l.length-1;g--;){var x=l[g],i=l[g+1];x[0]===i[0]&&x[1]===i[1]&&l.splice(g,1)}return l}function h(l,g){var x,i,s=l.last();s.next=new v(l.vec,s),s.next.prev=s;var t=g.last();t.next=new v(g.vec,t),t.next.prev=t;var e=!1;for(x=l;x.next;x=x.next)if(!x.intersect){for(i=g;i.next;i=i.next)if(!i.intersect){var u=x.vec,M=x.next.nextNonIntersection().vec,R=i.vec,d=i.next.nextNonIntersection().vec,q=S(u,M,R,d);if(q&&q!==!0){e=!0;var D=new v(q,n(u,q)/n(u,M),!0),P=new v(q,n(R,q)/n(R,d),!0);D.neighbor=P,P.neighbor=D,D.insertBetween(x,x.next.nextNonIntersection()),P.insertBetween(i,i.next.nextNonIntersection())}}}return e}function b(l,g,x,i,s){var t,e,u=x(l.vec)<0;for(s==="and"&&(u=!u),t=l;t.next;t=t.next)t.intersect&&(t.entry=u,u=!u);var M=i(g.vec)>0;for(s==="or"&&(M=!M),e=g;e.next;e=e.next)e.intersect&&(e.entry=M,M=!M)}function k(l,g){l.createLoop(),g.createLoop();for(var x,i=[],s;(x=l.firstNodeOfInterest())!==l;){for(s=[];!x.visited;x=x.neighbor){s.push(x.vec);for(var t=x.entry;;)if(x.visited=!0,x=t?x.next:x.prev,x.intersect){x.visited=!0;break}else s.push(x.vec)}i.push(r(s))}return i}function a(l,g,x){var i=o(l),s=o(g),t=f([g]),e=f([l]),u,M=h(i,s);if(M)b(i,s,t,e,x),u=k(i,s);else{var R=t(l[0])<0,d=e(g[0])<0;switch(u=[],x){case"or":!R&&!d?(u.push(c(l)),u.push(c(g))):R?u.push(c(g)):d&&u.push(c(l));break;case"and":if(R)u.push(c(l));else if(d)u.push(c(g));else throw new Error("woops");break;case"not":var q=c(l),D=c(g),P=p(q),I=p(D);w(P)===w(I)&&(d?D.reverse():R&&q.reverse()),u.push(q),_(P)>_(I)?u.push(D):u.unshift(D);break}}return u}return Ft=a,Ft}var Et,be;function fr(){if(be)return Et;be=1,Et=S;function S(f){for(var p=f.length,w=f[f.length-1],_=p,c=p-2;c>=0;--c){var v=w,o=f[c];w=v+o;var n=w-v,r=o-n;r&&(f[--_]=w,w=r)}for(var h=0,c=_;c<p;++c){var v=f[c],o=w;w=v+o;var n=w-v,r=o-n;r&&(f[h++]=r)}return f[h++]=w,f.length=h,f}return Et}var Lt,ke;function ur(){if(ke)return Lt;ke=1,Lt=p;var S=pt()[3];function f(w,_,c,v){for(var o=0;o<2;++o){var n=w[o],r=_[o],h=Math.min(n,r),b=Math.max(n,r),k=c[o],a=v[o],l=Math.min(k,a),g=Math.max(k,a);if(g<h||b<l)return!1}return!0}function p(w,_,c,v){var o=S(w,c,v),n=S(_,c,v);if(o>0&&n>0||o<0&&n<0)return!1;var r=S(c,w,_),h=S(v,w,_);return r>0&&h>0||r<0&&h<0?!1:o===0&&n===0&&r===0&&h===0?f(w,_,c,v):!0}return Lt}var jt,Se;function hr(){if(Se)return jt;Se=1,jt=c;var S=Vt(),f=Ce(),p=Be(),w=fr(),_=ur();function c(v,o,n,r){if(!_(v,o,n,r))return[[0],[0],[0]];var h=f([n[1]],[-r[1]]),b=f([-n[0]],[r[0]]),k=f(f(p(b,v[1]),p(b,-o[1])),f(p(h,v[0]),p(h,-o[0]))),a=f(S(-v[0],o[1]),S(v[1],o[0])),l=f(S(-n[0],r[1]),S(n[1],r[0])),g=f(f(p(l,v[0]),p(l,-o[0])),f(p(a,-n[0]),p(a,r[0]))),x=f(f(p(l,v[1]),p(l,-o[1])),f(p(a,-n[1]),p(a,r[1])));return[w(g),w(x),w(k)]}return jt}var Ct,qe;function lr(){if(qe)return Ct;qe=1,Ct=S;function S(f){var p=0,w=f.length;switch(w){case 1:p=f[0];break;case 2:p=f[0]+f[1];break;case 3:p=f[0]+f[1]+f[2];break;case 4:p=f[0]+f[1]+f[2]+f[3];break;default:for(var _=0;_<w;_++)p+=f[_]}return p}return Ct}var Bt,De;function cr(){if(De)return Bt;De=1;var S=hr(),f=lr();Bt=n;function p(r,h){return r[0]===h[0]&&r[1]===h[1]}var w=[0,0],_=[0,0],c=[0,0],v=[0,0];function o(r,h){Array.isArray(r)?(h[0]=r[0],h[1]=r[1]):(h[0]=r.x,h[1]=r.y)}function n(r,h){for(var b={},k=r.length,a=[],l=0;l<k;l++){var g=r[l],x=r[(l+1)%k];o(g,c),o(x,v);for(var i=0;i<k;i++)if(l!==i){var s=r[i],t=r[(i+1)%k];if(o(s,w),o(t,_),!(p(w,c)||p(w,v)||p(_,c)||p(_,v))){var e=S(c,v,w,_),u=e[2];if(!(u.length===1&&!u[0])){var M=f(e[2]);if(e[0]=f(e[0])/M,e[1]=f(e[1])/M,e.pop(),!(p(e,c)||p(e,v)||p(e,w)||p(e,_))){var R=e+"",d=!b[R];d&&(b[R]=!0);var q=d;h&&(q=h(e,l,g,x,i,s,t,d)),q&&a.push(e)}}}}}return a}return Bt}(function(S){if(typeof Le<"u")var f=Qe(),p=Jt(),w=Ge(),_=ar(),c=cr();var v=Math.PI,o=v*2,n=function(a){return a<0&&(a+=o),a},r=function(a){return Object.prototype.toString.call(a)==="[object Array]"},h=function(a){return typeof a=="function"},b=function(a){return typeof a<"u"};function k(a){if(a instanceof k)return a;if(!(this instanceof k))return new k(a);Array.isArray(a)||(a=a?[a]:[]),this.points=a.map(function(l){if(Array.isArray(l))return f.fromArray(l);if(l instanceof f)return l;if(typeof l.x<"u"&&typeof l.y<"u")return f(l.x,l.y)})}k.prototype={each:function(a){for(var l=0;l<this.points.length&&a.call(this,this.point(l-1),this.point(l),this.point(l+1),l)!==!1;l++);return this},insert:function(a,l){this.points.splice(l,0,a)},point:function(a){var l=a%this.points.length;return l<0&&(l=this.points.length+l),this.points[l]},dedupe:function(a){var l={},g=this.points.filter(function(x){var i=x.x+":"+x.y;if(!l[i])return l[i]=!0,!0});return a?new k(g):(this.points=g,this)},remove:function(a){return typeof a=="number"?this.points.splice(a,1):this.points=this.points.filter(function(l){return l!==a}),this},clean:function(a){var l=this.point(-1),g=this.points.filter(function(x){var i=!1;return l.equal(x)||(i=!0),l=x,i});return a?new k(g):(this.points=g,this)},simplify:function(){var a=function(u){return Math.round(u*1e4)/1e4},l=function(u,M,R){var d=u.x*(M.y-R.y)+M.x*(R.y-u.y)+R.x*(u.y-M.y);return a(d)===0};this.points=this.points.filter(Boolean);for(var g=[],x=0;x<this.points.length;x++){var i=this.point(x-1),s=this.point(x+1),t=this.point(x),e=t.subtract(i,!0).angleTo(t.subtract(s,!0));!l(i,t,s)&&a(e)&&g.push(t)}return this.points=g,this},winding:function(){return this.area()>0},rewind:function(a){a=!!a;var l=this.winding();return l!==a&&this.points.reverse(),this},area:function(){var a=0,l=this.point(0);return this.each(function(g,x,i,s){if(!(s<2)){var t=l.subtract(x,!0),e=l.subtract(g,!0);a+=t.x*e.y-t.y*e.x}}),a/2},closestPointTo:function(a){var l=this.points.length,g=1/0,x=null,i=0,s=!1,t;for(t=0;t<l;t++){var e=this.point(t-1),u=this.point(t);if(!e.equal(u)){var M=u.subtract(e,!0),R=a.subtract(e,!0),d=R.dot(M),q=M.dot(M),D=Math.min(Math.max(d/q,0),1),P=M.multiply(D).add(e),I=a.subtract(P,!0).lengthSquared();I<g&&(x=P,i=t,s=D===0||D===1,g=I)}}return x.prev=this.point(i-1),x.next=this.point(i+1),s&&(x.current=this.point(i)),x},center:function(){var a=this.aabb();return f(a.x+a.w/2,a.y+a.h/2)},scale:function(a,l,g){var x=this;g&&(x=this.clone()),l||(l=x.center()),x.each(function(s,t){t.multiply(a)});var i=l.multiply(a,!0).subtract(l);return x.each(function(s,t){t.subtract(i)}),x},containsPoint:function(a){var l=!1;return this.each(function(g,x,i){(g.y<=a.y&&a.y<x.y||x.y<=a.y&&a.y<g.y)&&a.x<(x.x-g.x)*(a.y-g.y)/(x.y-g.y)+g.x&&(l=!l)}),l},containsPolygon:function(a){r(a)&&(a=new k(a));for(var l=0;l<a.points.length;l++)if(!this.containsPoint(a.points[l]))return!1;for(var l=0;l<this.points.length;l++)for(var g=this.line(l),x=0;x<a.points.length;x++){var i=a.line(x),s=p(g[0],g[1],i[0],i[1]);if(s&&s!==!0)return!1}return!0},aabb:function(){if(this.points.length<2)return{x:0,y:0,w:0,h:0};var a,l,g,x,i=this.point(1);return l=a=i.x,g=x=i.y,this.each(function(s,t){t.x>l&&(l=t.x),t.x<a&&(a=t.x),t.y>g&&(g=t.y),t.y<x&&(x=t.y)}),{x:a,y:x,w:l-a,h:g-x}},offset:function(a,l){var g=[];this.rewind(!1).simplify().each(function(t,e,u,M){var R=e.subtract(t,!0).normalize(),d=e.subtract(u,!0).normalize(),q=a/Math.sin(Math.acos(R.dot(d))/2),D=R.add(d,!0).normalize().multiply(q,!0),P=n(R.angleTo(d)),I=R.perpDot(d)<0?e.add(D,!0):e.subtract(D,!0);(P>o*.75||P<o*.25)&&(I.computeSegments=P,e.color="white",e.radius=3),I.point=e,g.push(I)});var x=function(t,e){var u=t.subtract(e,!0),M=f(1,0).angleTo(u),R=f(a,0).rotate(M+Math.PI/2);R.add(e);var d=R.add(u,!0),q=new w(R.x,R.y,d.x,d.y),D=t.add(u,!0);return new w(t.x,t.y,D.x,D.y),q},i=k(g),s=[];return i.each(function(t,e,u,M){var R=p(e,e.point,u,u.point);if(R){var d=i.point(M-2),q=i.point(M+2);x(d.point,t.point);var D=x(t.point,e.point);x(e.point,u.point);var P=x(u.point,q.point),I=D.intersect(P);I.color="yellow",I.point=e.point,s.push(I)}else s.push(e)}),s.length?k(s):i},line:function(a){return[this.point(a),this.point(a+1)]},lines:function(a){var l=0;return this.each(function(g,x,i){a(x,i,l++)}),this},selfIntersections:function(){var a=[];return c(this.points,function(l,g,x,i,s,t,e,u){if(u){var M=f.fromArray(l);return a.push(M),M.s=g+x.subtract(M,!0).length()/x.subtract(i,!0).length(),M.b=s+t.subtract(M,!0).length()/t.subtract(e,!0).length(),M.si=g,M.bi=s,!1}}),k(a)},pruneSelfIntersections:function(){var a=this.selfIntersections(),l=function(I,A,z,j){return I>z&&A<j},g=function(I,A,z,j){return I<z&&A>j},x=function(I,A,z,j){return I<z&&z<A&&j>A||z<A&&A<j&&I<z};function i(I,A){this.value=I,this.depth=this.depth,this.children=[]}var s=this.point(0).clone();s.s=0,s.b=this.points.length-1+.99;var t=new i(s),e=t,u=[s];a.each(function(I,A,z){console.log("belongTo:",l(e.s,e.b,A.s,A.b),"contain:",g(e.s,e.b,A.s,A.b),"interfere:",x(e.s,e.b,A.s,A.b)),u.push(A),e=A});var M=[];if(u.length<2)return[this];u.sort(function(I,A){return I.s-A.s});for(var R=0;R<u.length;R+=2){var d=[],q=R<u.length-1?u[R+1]:null;if(q){for(var D=Math.floor(u[R].s);D<=Math.floor(q.s);D++)d.push(this.point(D));d.push(q);for(var D=Math.floor(q.b+1);D<=Math.floor(u[R].b);D++)d.push(this.point(D))}else{d.push(u[R]);for(var P=Math.floor(u[R].s+1);P<=Math.floor(u[R].b);P++)d.push(this.point(P))}M.push(new k(d))}return M},get length(){return this.points.length},clone:function(){var a=[];return this.each(function(l,g){a.push(g.clone())}),new k(a)},rotate:function(a,l,g){l=l||this.center();var x=g?this.clone():this;return x.each(function(i,s){s.subtract(l).rotate(a).add(l)})},translate:function(a,l){var g=l?this.clone():this;return g.each(function(x,i){i.add(a)}),g},equal:function(a){for(var l=a.length;l--;)if(!this.point(l).equal(a.point(l)))return!1;return!0},containsCircle:function(a,l,g){var x=new f(a,l);if(!this.containsPoint(x))return!1;var i=this.closestPointTo(x);if(i.distance(x)>=g)return!0},contains:function(a){if(!a)return!1;if(b(a.radius)&&a.position){var l;return h(a.radius)?l=a.radius():l=a.radius,this.containsCircle(a.position.x,a.position.y,l)}else if(typeof a.points<"u"){var g;return(h(a.containsPolygon)||r(a.points))&&(g=a.points),this.containsPolygon(g)}else{if(b(a.x1)&&b(a.x2)&&b(a.y1)&&b(a.y2))return this.containsPolygon([new f(a.x1,a.y1),new f(a.x2,a.y1),new f(a.x2,a.y2),new f(a.x1,a.y2)]);if(b(a.x)&&b(a.y)){var x,i;return b(a.w)&&b(a.h)&&(x=a.x+a.w,i=a.y+a.h),b(a.width)&&b(a.height)&&(x=a.x+a.width,i=a.y+a.height),this.containsPolygon([new f(a.x,a.y),new f(x,a.y),new f(x,i),new f(a.x,i)])}}return!1},union:function(a){return k(_(this.toArray(),a.toArray(),"or")[0])},cut:function(a){return _(this.toArray(),a.toArray(),"not").map(function(l){return new k(l)})},intersect:function(a){return _(this.toArray(),a.toArray(),"and").map(function(l){return new k(l)})},toArray:function(){for(var a=this.length,l=Array(a),g=0;g<a;g++)l[g]=this.points[g].toArray();return l},toString:function(){return this.points.join(",")}},S.exports&&(S.exports=k),typeof window<"u"&&(window.Polygon=k)})(je);var vr=je.exports;const Xt=Ke(vr);class gr{constructor(f,p=[],w=[]){N(this,"canvas");N(this,"ctx");N(this,"interval",0);N(this,"displayMeasurements",!1);N(this,"windowImage",new Image);N(this,"singleDoorImage",new Image);N(this,"doubleDoorImage",new Image);N(this,"stairsImage",new Image);N(this,"centerPosition",{x:0,y:0});N(this,"canvasOffset",{x:0,y:0});N(this,"objects",[{type:B.Door,position:{x:0,y:0},rotation:0}]);N(this,"testRoom",{quality:0,lines:[{start:{x:-5,y:-5},end:{x:-5,y:5}},{start:{x:-5,y:5},end:{x:5,y:5}},{start:{x:5,y:5},end:{x:5,y:-5}},{start:{x:5,y:-5},end:{x:-5,y:-5}}],position:{x:0,y:0},rotation:0,type:B.Room,name:"Test room"});N(this,"rooms",[this.testRoom]);N(this,"minimumPointSize",20);N(this,"pointSize",this.minimumPointSize);N(this,"lineWidth",1/3*this.pointSize);N(this,"scale",1);N(this,"halfPointSize",this.pointSize/2);N(this,"transformFakeToDrawable",(f,p=rt.Center,w=rt.Center)=>{let _=0,c=0;return p===rt.Right&&(_=this.pointSize),p===rt.Center&&(_=this.halfPointSize),w===rt.Bottom&&(c=this.pointSize),w===rt.Center&&(c=this.halfPointSize),{x:f.x*this.pointSize+this.canvasOffset.x-this.halfPointSize+_,y:-f.y*this.pointSize+this.canvasOffset.y-this.halfPointSize+c}});N(this,"transformRealToFake",f=>{const p={x:f.x-this.canvasOffset.x,y:this.canvasOffset.y-f.y};return{x:Math.round(p.x/this.pointSize),y:Math.round(p.y/this.pointSize)}});this.canvas=f,this.ctx=f.getContext("2d"),this.objects=p,this.rooms=w,this.windowImage.src="window-path.svg",this.singleDoorImage.src="single-door.svg",this.doubleDoorImage.src="double-doors.svg",this.stairsImage.src="stairs.svg",console.log(`Floor Renderer constructor! ${this.canvas} ... ${this.ctx}`)}dpiFix(f,p){const w=f,_=p,c=Math.ceil(window.devicePixelRatio);this.pointSize=20,this.canvas.width=w*c,this.canvas.height=_*c,this.canvas.style.width=`${w}px`,this.canvas.style.height=`${_}px`,this.ctx.scale(c,c),this.setCenter(),this.redraw()}setCenter(){let f=this.canvas.clientWidth,p=this.canvas.clientHeight;this.centerPosition={x:f/2,y:p/2}}redraw(){const f=this.ctx;f&&(f.clearRect(0,0,1e4,1e4),this.setCenter(),this.rooms.forEach(p=>{this.drawRoom(p)}),this.drawObjects())}drawRoom(f){const p=this.ctx;this.colorRoom(f),p.beginPath(),f.lines.forEach(h=>this.drawLine(h)),p.strokeStyle="black",p.lineWidth=this.lineWidth,p.stroke();const w=new Xt(f.lines.map(h=>h.start)),_=w.area();p.fillStyle="white";const c=w.center(),v={x:c.x,y:c.y},o=this.transformFakeToDrawable(v);if(this.displayMeasurements){f.lines.forEach(l=>this.displayLineDistance(l,void 0,w));const h={x:c.x,y:c.y},b=this.transformFakeToDrawable(h),k=`${Math.abs(_/(this.pointSize*this.pointSize)*100).toFixed(1)}m`,a=this.ctx.measureText(k);p.fillText(k,b.x,b.y),p.font=`${this.halfPointSize*.8}px Arial`,p.fillText("2",b.x+a.actualBoundingBoxRight+5,b.y-a.fontBoundingBoxAscent)}const n=f.name,r=this.ctx.measureText(n);p.font=`${this.pointSize*.8}px Arial`,p.fillText(f.name,o.x-r.width/2,o.y)}colorRoom(f){if(f.lines.length<=2)return;const p=f.lines[0].start,w=f.lines[f.lines.length-2].start,_=this.transformFakeToDrawable(p),c=this.transformFakeToDrawable(w),v=this.ctx.createLinearGradient(_.x,_.y,c.x,c.y);v.addColorStop(0,"rgb(112, 171, 153)"),v.addColorStop(1,"rgb(101, 164, 145)"),this.ctx.fillStyle=f.quality===0?"rgba(0,0,0, .5)":v,this.ctx.beginPath(),this.ctx.moveTo(_.x,_.y),f.lines.forEach(({start:o,end:n})=>{const r=this.transformFakeToDrawable(n);this.ctx.lineTo(r.x,r.y)}),this.ctx.moveTo(_.x,_.y),this.ctx.closePath(),this.ctx.fill()}drawLine(f){const p=this.transformFakeToDrawable(f.start),w=this.transformFakeToDrawable(f.end);this.ctx.lineCap="round",this.ctx.moveTo(p.x,p.y),this.ctx.lineTo(w.x,w.y)}displayLineDistance(f,p=void 0,w=void 0){const{start:_,end:c}=f;let v=this.getLineDirection(f),o=0,n=0;const r=Math.sqrt(Math.abs(_.x-c.x)**2+Math.abs(_.y-c.y)**2),h={x:(c.x+_.x)/2,y:(c.y+_.y)/2},b=this.transformFakeToDrawable(h);if(w){const{x:a,y:l}=w.center(),g={x:a,y:l};v=this.getLineDirection({start:h,end:g})}o=v.x===0?0:Math.sign(v.x)*this.pointSize,n=v.y===0?0:-Math.sign(v.y)*this.halfPointSize*1.25;let k=this.ctx;k.font=`${this.halfPointSize}px Verdana`,k.textAlign="center",k.textBaseline="middle",k.fillText(`${(r/2).toFixed(1)}m`,(p==null?void 0:p.x)??b.x+o,(p==null?void 0:p.y)??b.y+n)}getLineDirection(f){const{start:p,end:w}=f;return{x:w.x-p.x,y:w.y-p.y}}drawObjects(){let f=this.ctx;if(f)for(let p of this.objects){const w=p.type===B.Stairs?6:2.5;p.rotation==0,p.rotation==.5,p.rotation==1,p.rotation==1.5;const _=this.transformFakeToDrawable(p.position),c=p.rotation;f.save(),f.translate(_.x-this.pointSize,_.y-this.pointSize),f.rotate(Math.PI*c);let v=this.singleDoorImage;switch(p.type){case B.Door:v=this.singleDoorImage;break;case B.Window:v=this.windowImage;break;case B.DoubleDoor:v=this.doubleDoorImage;break;case B.Stairs:v=this.stairsImage;break}f.drawImage(v,-w/2*this.pointSize,-w/2*this.pointSize,w*this.pointSize,w*this.pointSize),f.restore()}}drawGrid(f,p){const w=this.ctx,_=this.pointSize,c=this.pointSize/100;this.ctx.lineWidth=c,this.ctx.strokeStyle="rgba(0, 0, 0, 0.1)";for(let v=-p;v<f;v++){w.beginPath();const o=v*_+this.canvasOffset.x+this.halfPointSize-c/2;w.strokeText(`${v}`,o-_*5/8,50),w.moveTo(o,0),w.lineTo(o,p),w.closePath(),w.stroke()}for(let v=-f;v<p;v++){const o=-v*_+this.canvasOffset.y-this.halfPointSize+c/2;w.strokeText(`${v}`,50,o+_*5/8),w.beginPath(),w.moveTo(0,o),w.lineTo(f,o),w.closePath(),w.stroke()}}}function Me(S){let f,p,w,_,c,v,o,n,r,h,b,k,a,l,g=S[8]&&Pe(S);return{c(){f=W("div"),g&&g.c(),p=ot(),w=W("div"),_=W("img"),v=ot(),o=W("div"),n=W("img"),this.h()},l(x){f=U(x,"DIV",{id:!0,style:!0,class:!0});var i=Q(f);g&&g.l(i),p=st(i),w=U(i,"DIV",{class:!0});var s=Q(w);_=U(s,"IMG",{src:!0,class:!0}),s.forEach(E),v=st(i),o=U(i,"DIV",{class:!0});var t=Q(o);n=U(t,"IMG",{src:!0,class:!0}),t.forEach(E),i.forEach(E),this.h()},h(){var x;Kt(_.src,c="/rotate.svg")||L(_,"src",c),L(_,"class","svelte-1vxmyrg"),L(w,"class","button svelte-1vxmyrg"),Kt(n.src,r="/trash.svg")||L(n,"src",r),L(n,"class","svelte-1vxmyrg"),L(o,"class","button svelte-1vxmyrg"),L(f,"id","toolbar"),it(f,"left",S[5].x-((x=S[4])==null?void 0:x.clientWidth)/2+"px"),it(f,"top",S[5].y+2*S[9]+"px"),it(f,"transition","none"),L(f,"class","svelte-1vxmyrg")},m(x,i){Z(x,f,i),g&&g.m(f,null),J(f,p),J(f,w),J(w,_),J(f,v),J(f,o),J(o,n),S[28](f),k=!0,a||(l=[H(_,"click",S[26]),H(n,"click",S[27])],a=!0)},p(x,i){var s;x[8]?g?g.p(x,i):(g=Pe(x),g.c(),g.m(f,p)):g&&(g.d(1),g=null),(!k||i[0]&48)&&it(f,"left",x[5].x-((s=x[4])==null?void 0:s.clientWidth)/2+"px"),(!k||i[0]&32)&&it(f,"top",x[5].y+2*x[9]+"px")},i(x){k||(x&&Wt(()=>{k&&(b&&b.end(1),h=Fe(f,gt,{}),h.start())}),k=!0)},o(x){h&&h.invalidate(),x&&(b=Ee(f,gt,{})),k=!1},d(x){x&&E(f),g&&g.d(),S[28](null),x&&b&&b.end(),a=!1,Te(l)}}}function Pe(S){let f,p,w;return{c(){f=W("input")},l(_){f=U(_,"INPUT",{})},m(_,c){Z(_,f,c),Gt(f,S[8].name),p||(w=H(f,"input",S[25]),p=!0)},p(_,c){c[0]&256&&f.value!==_[8].name&&Gt(f,_[8].name)},d(_){_&&E(f),p=!1,w()}}}function yr(S){let f,p,w,_,c;Wt(S[20]);let v=S[5]&&(S[2]||S[8])&&Me(S);return{c(){f=W("canvas"),p=ot(),v&&v.c(),w=Zt(),this.h()},l(o){f=U(o,"CANVAS",{class:!0}),Q(f).forEach(E),p=st(o),v&&v.l(o),w=Zt(),this.h()},h(){L(f,"class","svelte-1vxmyrg")},m(o,n){Z(o,f,n),S[21](f),Z(o,p,n),v&&v.m(o,n),Z(o,w,n),_||(c=[H(window,"resize",S[20]),H(f,"click",S[11]),H(f,"mousedown",S[22]),H(f,"mouseenter",S[23]),H(f,"mousemove",S[10]),H(f,"mouseup",S[24])],_=!0)},p(o,n){o[5]&&(o[2]||o[8])?v?(v.p(o,n),n[0]&292&&m(v,1)):(v=Me(o),v.c(),m(v,1),v.m(w.parentNode,w)):v&&(ze(),at(v,1,1,()=>{v=null}),Ne())},i(o){m(v)},o(o){at(v)},d(o){o&&(E(f),E(p),E(w)),S[21](null),v&&v.d(o),_=!1,Te(c)}}}const pr=20;let Re=10;function wr(S,f,p){let w,_,c,v,o,n;K(S,ut,O=>p(16,w=O)),K(S,nt,O=>p(17,_=O)),K(S,lt,O=>p(2,c=O)),K(S,ct,O=>p(8,v=O)),K(S,vt,O=>p(18,o=O)),K(S,yt,O=>p(19,n=O));let r,h=!1,b,k={x:0,y:0},a,l,g,x,i=pr,s={x:0,y:0},t=s;function e(O){if(p(15,s={x:O.clientX,y:O.clientY}),O.button==1||O.button==1&2){let T=O.clientX-t.x,F=O.clientY-t.y;p(14,r.canvasOffset.x+=T,r),p(14,r.canvasOffset.y+=F,r),p(7,t={...s}),$(lt,c=void 0,c)}h&&R()}He(async()=>{p(14,r=new gr(a)),p(14,r.rooms=[r.testRoom],r),l=r.ctx,r.dpiFix(x,g),p(14,r.canvasOffset=r.centerPosition,r),r.redraw()});function u(O){const T=r.transformRealToFake({x:O.clientX,y:O.clientY});if(!(O.movementX>0||O.movementY>0))if(n===tt.Drawing){const F=o.length,Y=o[F-1]??{start:{x:T.x,y:T.y},end:{x:T.x,y:T.y}};if(console.log(o.length),o.includes(Y)||vt.update(C=>(C.push(Y),C)),JSON.stringify(T)!==JSON.stringify(Y.start)){if(Y.end=T,JSON.stringify(Y.end)===JSON.stringify(o[0].start)){const G=new Xt(o.map(wt=>wt.end)).center(),Xe={lines:[...o],quality:0,position:{x:G.x,y:G.y},rotation:0,type:B.Room,name:"No Name"};$(vt,o=[],o),$(yt,n=tt.None,n),ut.update(wt=>[...wt,Xe])}else vt.update(C=>(C.push({start:{x:T.x,y:T.y},end:{x:T.x,y:T.y}}),C));return}}else{const F=[{x:T.x-2,y:T.y-2},{x:T.x-2,y:T.y+2},{x:T.x+2,y:T.y+2},{x:T.x+2,y:T.y-2},{x:T.x-2,y:T.y-2}],X=new Xt(F),Y=r.objects.findLast(C=>X.contains({x:C.position.x,y:C.position.y,w:0,h:0}));if($(lt,c=Y,c),p(5,k=s),!Y){const C=r.rooms.findLast(G=>X.contains({x:G.position.x,y:G.position.y,w:0,h:0}));$(ct,v=C,v)}}}function M(){const O=o[o.length-1];l&&O&&(r.getLineDirection(O),r.transformFakeToDrawable(O.start),O.end=r.transformRealToFake(s),l.beginPath(),r.drawLine(O),l.lineWidth=Re,l.stroke(),l.fillStyle="black",r.displayLineDistance(O,{x:s.x+i,y:s.y-i}))}function R(){const O=c;O&&(O.position=r.transformRealToFake({x:s.x+i,y:s.y+i}),p(5,k=s))}function d(){const O=c;O&&(O.rotation+=.5,O.rotation===2&&(O.rotation=0),r==null||r.redraw())}function q(){const O=v;O&&ut.update(F=>{const X=F.indexOf(O);return F.splice(X,1),F});const T=c;T&&nt.update(F=>{const X=F.indexOf(T);return F.splice(X,1),F}),$(ct,v=void 0,v),$(lt,c=void 0,c)}function D(){p(0,g=window.innerHeight),p(1,x=window.innerWidth)}function P(O){Qt[O?"unshift":"push"](()=>{a=O,p(6,a)})}const I=O=>{p(7,t={x:O.clientX,y:O.clientY}),p(3,h=O.button===0)},A=O=>p(7,t={x:O.clientX,y:O.clientY}),z=()=>{p(3,h=!1)};function j(){v.name=this.value,ct.set(v)}const et=()=>d(),V=()=>q();function ht(O){Qt[O?"unshift":"push"](()=>{b=O,p(4,b)})}return S.$$.update=()=>{if(S.$$.dirty[0]&147456&&r&&p(14,r.objects=_,r),S.$$.dirty[0]&81920&&r&&p(14,r.rooms=w,r),S.$$.dirty[0]&16387&&g&&r.dpiFix(x,g),S.$$.dirty[0]&16387&&x&&r.dpiFix(x,g),S.$$.dirty[0]&311296&&s&&(r==null||r.redraw(),M(),r)){const O=r.ctx,T=o[0];if(T){O.strokeStyle="orange",O.lineWidth=Re;const F=r.transformFakeToDrawable(T.start);O.beginPath(),O.moveTo(F.x,F.y),o.forEach(X=>r.drawLine(X)),O.stroke()}}S.$$.dirty[0]&16384&&(r==null||r.redraw()),S.$$.dirty[0]&540672&&n&&(r==null||r.redraw()),S.$$.dirty[0]&16388&&c&&(r==null||r.redraw())},[g,x,c,h,b,k,a,t,v,i,e,u,d,q,r,s,w,_,o,n,D,P,I,A,z,j,et,V,ht]}class xr extends Ut{constructor(f){super(),Ht(this,f,wr,yr,Yt,{},null,[-1,-1])}}function Ie(S,f,p){const w=S.slice();return w[10]=f[p],w[12]=p,w}function Oe(S){let f,p,w,_;return{c(){f=W("div"),this.h()},l(c){f=U(c,"DIV",{id:!0,class:!0}),Q(f).forEach(E),this.h()},h(){L(f,"id","drawing-indicator"),L(f,"class","svelte-qwaka0")},m(c,v){Z(c,f,v),_=!0},i(c){_||(c&&Wt(()=>{_&&(w&&w.end(1),p=Fe(f,gt,{}),p.start())}),_=!0)},o(c){p&&p.invalidate(),c&&(w=Ee(f,gt,{})),_=!1},d(c){c&&E(f),c&&w&&w.end()}}}function Ae(S){let f,p,w,_,c;return{c(){f=W("div"),p=W("button"),w=ot(),this.h()},l(v){f=U(v,"DIV",{class:!0});var o=Q(f);p=U(o,"BUTTON",{class:!0,style:!0}),Q(p).forEach(E),w=st(o),o.forEach(E),this.h()},h(){L(p,"class","button svelte-qwaka0"),it(p,"mask-image","url('"+S[10].icon+"')"),L(f,"class","button-container svelte-qwaka0")},m(v,o){Z(v,f,o),J(f,p),J(f,w),_||(c=H(p,"click",S[10].action),_=!0)},p(v,o){S=v},d(v){v&&E(f),_=!1,c()}}}function dr(S){let f,p,w=S[0]===tt.Drawing&&Oe(),_=re(S[1]),c=[];for(let v=0;v<_.length;v+=1)c[v]=Ae(Ie(S,_,v));return{c(){f=W("div"),w&&w.c(),p=ot();for(let v=0;v<c.length;v+=1)c[v].c();this.h()},l(v){f=U(v,"DIV",{id:!0,class:!0});var o=Q(f);w&&w.l(o),p=st(o);for(let n=0;n<c.length;n+=1)c[n].l(o);o.forEach(E),this.h()},h(){L(f,"id","container"),L(f,"class","svelte-qwaka0")},m(v,o){Z(v,f,o),w&&w.m(f,null),J(f,p);for(let n=0;n<c.length;n+=1)c[n]&&c[n].m(f,null)},p(v,[o]){if(v[0]===tt.Drawing?w?o&1&&m(w,1):(w=Oe(),w.c(),m(w,1),w.m(f,p)):w&&(ze(),at(w,1,1,()=>{w=null}),Ne()),o&2){_=re(v[1]);let n;for(n=0;n<_.length;n+=1){const r=Ie(v,_,n);c[n]?c[n].p(r,o):(c[n]=Ae(r),c[n].c(),c[n].m(f,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=_.length}},i(v){m(w)},o(v){at(w)},d(v){v&&E(f),w&&w.d(),Ve(c,v)}}}function _r(S,f,p){let w,_,c;K(S,nt,a=>p(2,w=a)),K(S,ut,a=>p(3,_=a)),K(S,yt,a=>p(0,c=a));const v=[{icon:"./point.svg",action:o},{icon:"./doors.svg",action:()=>n(!1)},{icon:"./double-doors.svg",action:()=>n(!0)},{icon:"./stairs.svg",action:h},{icon:"./window.svg",action:r},{icon:"./import.svg",action:b},{icon:"./export.svg",action:k}];function o(){$(yt,c=c===tt.Drawing?tt.None:tt.Drawing,c)}function n(a=!1){nt.update(l=>(l.push({position:{x:0,y:0},rotation:0,type:a?B.DoubleDoor:B.Door}),l))}function r(){nt.update(a=>(a.push({position:{x:0,y:0},rotation:0,type:B.Window}),a))}function h(){nt.update(a=>(a.push({position:{x:0,y:0},rotation:0,type:B.Stairs}),a))}function b(){const a=document.createElement("input");a.type="file",a.style.display="none",a.click(),a.onchange=async l=>{const g=a.files.item(0),x=JSON.parse(await g.text());ut.set(x.rooms),nt.set(x.objects),a.remove()}}function k(){const l=JSON.stringify({rooms:_,objects:w}),g=new File([l],"floor-plan.json",{type:"application/json"}),x=URL.createObjectURL(g),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=x,i.download="floor-plan.json",i.click(),i.remove(),URL.revokeObjectURL(x)}return[c,v]}class br extends Ut{constructor(f){super(),Ht(this,f,_r,dr,Yt,{})}}function kr(S){let f,p,w,_,c;return p=new xr({}),_=new br({}),{c(){f=W("div"),$t(p.$$.fragment),w=ot(),$t(_.$$.fragment),this.h()},l(v){f=U(v,"DIV",{id:!0,class:!0});var o=Q(f);mt(p.$$.fragment,o),w=st(o),mt(_.$$.fragment,o),o.forEach(E),this.h()},h(){L(f,"id","container"),L(f,"class","svelte-18mbrbh")},m(v,o){Z(v,f,o),te(p,f,null),J(f,w),te(_,f,null),c=!0},p:Je,i(v){c||(m(p.$$.fragment,v),m(_.$$.fragment,v),c=!0)},o(v){at(p.$$.fragment,v),at(_.$$.fragment,v),c=!1},d(v){v&&E(f),ee(p),ee(_)}}}class Pr extends Ut{constructor(f){super(),Ht(this,f,null,kr,Yt,{})}}export{Pr as component};
